"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UsbmuxDecoder = void 0;
require("source-map-support/register");
var _stream = _interopRequireDefault(require("stream"));
var _support = require("@appium/support");
const HEADER_LENGTH = 16;
class UsbmuxDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }
  _transform(data, encoding, onData) {
    this._decode(data);
    onData();
  }
  _decode(data) {
    const header = {
      length: data.readUInt32LE(0),
      version: data.readUInt32LE(4),
      type: data.readUInt32LE(8),
      tag: data.readUInt32LE(12)
    };
    let payload = data.slice(HEADER_LENGTH, data.length);
    this.push({
      header,
      payload: _support.plist.parsePlist(payload)
    });
  }
}
exports.UsbmuxDecoder = UsbmuxDecoder;
var _default = UsbmuxDecoder;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3RyZWFtIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfc3VwcG9ydCIsIkhFQURFUl9MRU5HVEgiLCJVc2JtdXhEZWNvZGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsIl9kZWNvZGUiLCJoZWFkZXIiLCJsZW5ndGgiLCJyZWFkVUludDMyTEUiLCJ2ZXJzaW9uIiwidHlwZSIsInRhZyIsInBheWxvYWQiLCJzbGljZSIsInB1c2giLCJwbGlzdCIsInBhcnNlUGxpc3QiLCJleHBvcnRzIiwiX2RlZmF1bHQiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL3VzYm11eC90cmFuc2Zvcm1lci91c2JtdXgtZGVjb2Rlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cbmNvbnN0IEhFQURFUl9MRU5HVEggPSAxNjtcblxuY2xhc3MgVXNibXV4RGVjb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5fZGVjb2RlKGRhdGEpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IGhlYWRlciA9IHtcbiAgICAgIGxlbmd0aDogZGF0YS5yZWFkVUludDMyTEUoMCksXG4gICAgICB2ZXJzaW9uOiBkYXRhLnJlYWRVSW50MzJMRSg0KSxcbiAgICAgIHR5cGU6IGRhdGEucmVhZFVJbnQzMkxFKDgpLFxuICAgICAgdGFnOiBkYXRhLnJlYWRVSW50MzJMRSgxMilcbiAgICB9O1xuXG4gICAgbGV0IHBheWxvYWQgPSBkYXRhLnNsaWNlKEhFQURFUl9MRU5HVEgsIGRhdGEubGVuZ3RoKTtcbiAgICB0aGlzLnB1c2goeyBoZWFkZXIsIHBheWxvYWQ6IHBsaXN0LnBhcnNlUGxpc3QocGF5bG9hZCkgfSk7XG4gIH1cblxufVxuXG5leHBvcnQgeyBVc2JtdXhEZWNvZGVyIH07XG5leHBvcnQgZGVmYXVsdCBVc2JtdXhEZWNvZGVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUVBLE1BQU1FLGFBQWEsR0FBRyxFQUFFO0FBRXhCLE1BQU1DLGFBQWEsU0FBU0MsZUFBTSxDQUFDQyxTQUFTLENBQUM7RUFFM0NDLFdBQVdBLENBQUEsRUFBSTtJQUNiLEtBQUssQ0FBQztNQUFFQyxVQUFVLEVBQUU7SUFBSyxDQUFDLENBQUM7RUFDN0I7RUFFQUMsVUFBVUEsQ0FBRUMsSUFBSSxFQUFFQyxRQUFRLEVBQUVDLE1BQU0sRUFBRTtJQUNsQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0gsSUFBSSxDQUFDO0lBQ2xCRSxNQUFNLENBQUMsQ0FBQztFQUNWO0VBRUFDLE9BQU9BLENBQUVILElBQUksRUFBRTtJQUNiLE1BQU1JLE1BQU0sR0FBRztNQUNiQyxNQUFNLEVBQUVMLElBQUksQ0FBQ00sWUFBWSxDQUFDLENBQUMsQ0FBQztNQUM1QkMsT0FBTyxFQUFFUCxJQUFJLENBQUNNLFlBQVksQ0FBQyxDQUFDLENBQUM7TUFDN0JFLElBQUksRUFBRVIsSUFBSSxDQUFDTSxZQUFZLENBQUMsQ0FBQyxDQUFDO01BQzFCRyxHQUFHLEVBQUVULElBQUksQ0FBQ00sWUFBWSxDQUFDLEVBQUU7SUFDM0IsQ0FBQztJQUVELElBQUlJLE9BQU8sR0FBR1YsSUFBSSxDQUFDVyxLQUFLLENBQUNsQixhQUFhLEVBQUVPLElBQUksQ0FBQ0ssTUFBTSxDQUFDO0lBQ3BELElBQUksQ0FBQ08sSUFBSSxDQUFDO01BQUVSLE1BQU07TUFBRU0sT0FBTyxFQUFFRyxjQUFLLENBQUNDLFVBQVUsQ0FBQ0osT0FBTztJQUFFLENBQUMsQ0FBQztFQUMzRDtBQUVGO0FBQUNLLE9BQUEsQ0FBQXJCLGFBQUEsR0FBQUEsYUFBQTtBQUFBLElBQUFzQixRQUFBLEdBR2N0QixhQUFhO0FBQUFxQixPQUFBLENBQUFFLE9BQUEsR0FBQUQsUUFBQSJ9