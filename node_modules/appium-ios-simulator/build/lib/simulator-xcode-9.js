"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-8"));
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _support = require("@appium/support");
var _asyncLock = _interopRequireDefault(require("async-lock"));
var _logger = _interopRequireDefault(require("./logger"));
var _asyncbox = require("asyncbox");
var _utils = require("./utils.js");
var _defaultsUtils = require("./defaults-utils");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _events = require("events");
var _appiumXcode = require("appium-xcode");
var _teen_process = require("teen_process");
const SIMULATOR_SHUTDOWN_TIMEOUT = 15 * 1000;
const startupLock = new _asyncLock.default();
const preferencesPlistGuard = new _asyncLock.default();
const ENROLLMENT_NOTIFICATION_RECEIVER = 'com.apple.BiometricKit.enrollmentChanged';
const DOMAIN_KEYBOARD_PREFERENCES = 'com.apple.keyboard.preferences';
function compileSimulatorPreferences(opts = {}) {
  const {
    connectHardwareKeyboard,
    tracePointer,
    pasteboardAutomaticSync,
    scaleFactor
  } = opts;
  const commonPreferences = {
    RotateWindowWhenSignaledByGuest: true,
    StartLastDeviceOnLaunch: false,
    DetachOnWindowClose: false,
    AttachBootedOnStart: true
  };
  const devicePreferences = opts.devicePreferences ? _lodash.default.cloneDeep(opts.devicePreferences) : {};
  if (scaleFactor) {
    devicePreferences.SimulatorWindowLastScale = parseFloat(scaleFactor);
  }
  if (_lodash.default.isBoolean(connectHardwareKeyboard) || _lodash.default.isNil(connectHardwareKeyboard)) {
    devicePreferences.ConnectHardwareKeyboard = connectHardwareKeyboard ?? false;
    commonPreferences.ConnectHardwareKeyboard = connectHardwareKeyboard ?? false;
  }
  if (_lodash.default.isBoolean(tracePointer)) {
    commonPreferences.ShowSingleTouches = tracePointer;
    commonPreferences.ShowPinches = tracePointer;
    commonPreferences.ShowPinchPivotPoint = tracePointer;
    commonPreferences.HighlightEdgeGestures = tracePointer;
  }
  switch (_lodash.default.lowerCase(pasteboardAutomaticSync)) {
    case 'on':
      commonPreferences.PasteboardAutomaticSync = true;
      break;
    case 'off':
      commonPreferences.PasteboardAutomaticSync = false;
      break;
    case 'system':
      break;
    default:
      _logger.default.info(`['on', 'off' or 'system'] are available as the pasteboard automatic sync option. Defaulting to 'off'`);
      commonPreferences.PasteboardAutomaticSync = false;
  }
  return [devicePreferences, commonPreferences];
}
class SimulatorXcode9 extends _simulatorXcode.default {
  constructor(udid, xcodeVersion) {
    super(udid, xcodeVersion);
  }
  async run(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      isHeadless: false,
      startupTimeout: this.startupTimeout
    });
    const [devicePreferences, commonPreferences] = compileSimulatorPreferences(opts);
    await this.updatePreferences(devicePreferences, commonPreferences);
    const timer = new _support.timing.Timer().start();
    const shouldWaitForBoot = await startupLock.acquire(this.uiClientBundleId, async () => {
      const isServerRunning = await this.isRunning();
      const uiClientPid = await this.getUIClientPid();
      if (opts.isHeadless) {
        if (isServerRunning && !uiClientPid) {
          _logger.default.info(`Simulator with UDID '${this.udid}' is already booted in headless mode.`);
          return false;
        }
        if (await this.killUIClient({
          pid: uiClientPid
        })) {
          _logger.default.info(`Detected the Simulator UI client was running and killed it. Verifying the current Simulator state`);
        }
        try {
          await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
            waitMs: 5000,
            intervalMs: 100
          });
        } catch (e) {
          if (!(await this.isRunning())) {
            throw new Error(`Simulator with UDID '${this.udid}' cannot be transitioned to headless mode`);
          }
          return false;
        }
        _logger.default.info(`Booting Simulator with UDID '${this.udid}' in headless mode. ` + `All UI-related capabilities are going to be ignored`);
        await this.boot();
      } else {
        if (isServerRunning && uiClientPid) {
          _logger.default.info(`Both Simulator with UDID '${this.udid}' and the UI client are currently running`);
          return false;
        }
        if (isServerRunning) {
          _logger.default.info(`Simulator '${this.udid}' is booted while its UI is not visible. ` + `Trying to restart it with the Simulator window visible`);
          await this.shutdown({
            timeout: SIMULATOR_SHUTDOWN_TIMEOUT
          });
        }
        await this.launchWindow(uiClientPid, opts);
      }
      return true;
    });
    if (shouldWaitForBoot) {
      await this.waitForBoot(opts.startupTimeout);
      _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
    }
    (async () => {
      try {
        await this.disableKeyboardIntroduction();
      } catch (e) {
        _logger.default.info(`Cannot disable Simulator keyboard introduction. Original error: ${e.message}`);
      }
    })();
  }
  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      startupTimeout: this.startupTimeout
    });
    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', _utils.SIMULATOR_APP_NAME);
    const args = ['-Fn', simulatorApp];
    _logger.default.info(`Starting Simulator UI: ${_support.util.quote(['open', ...args])}`);
    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      throw new Error(`Got an unexpected error while opening Simulator UI: ` + err.stderr || err.stdout || err.message);
    }
  }
  async disableKeyboardIntroduction() {
    const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)({
      DidShowContinuousPathIntroduction: 1
    }, true);
    await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', DOMAIN_KEYBOARD_PREFERENCES, ...args])));
  }
  async launchWindow(isUiClientRunning, opts = {}) {
    await this.boot();
    if (!isUiClientRunning) {
      await this.startUIClient(opts);
    }
  }
  async boot() {
    const bootEventsEmitter = new _events.EventEmitter();
    await this.simctl.startBootMonitor({
      onError: err => bootEventsEmitter.emit('failure', err),
      onFinished: () => bootEventsEmitter.emit('finish'),
      shouldPreboot: true
    });
    try {
      await new _bluebird.default((resolve, reject) => {
        setTimeout(resolve, 3000);
        bootEventsEmitter.once('failure', err => {
          if (_lodash.default.includes(err === null || err === void 0 ? void 0 : err.message, 'state: Booted')) {
            resolve();
          } else {
            reject(err);
          }
        });
        bootEventsEmitter.once('finish', resolve);
      });
    } finally {
      bootEventsEmitter.removeAllListeners();
    }
  }
  verifyDevicePreferences(prefs = {}) {
    if (_lodash.default.isEmpty(prefs)) {
      return;
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowLastScale)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowLastScale) || prefs.SimulatorWindowLastScale <= 0) {
        _logger.default.errorAndThrow(`SimulatorWindowLastScale is expected to be a positive float value. ` + `'${prefs.SimulatorWindowLastScale}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowCenter)) {
      const verificationPattern = /{-?\d+(\.\d+)?,-?\d+(\.\d+)?}/;
      if (!_lodash.default.isString(prefs.SimulatorWindowCenter) || !verificationPattern.test(prefs.SimulatorWindowCenter)) {
        _logger.default.errorAndThrow(`SimulatorWindowCenter is expected to match "{floatXPosition,floatYPosition}" format (without spaces). ` + `'${prefs.SimulatorWindowCenter}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowOrientation)) {
      const acceptableValues = ['Portrait', 'LandscapeLeft', 'PortraitUpsideDown', 'LandscapeRight'];
      if (acceptableValues.indexOf(prefs.SimulatorWindowOrientation) === -1) {
        _logger.default.errorAndThrow(`SimulatorWindowOrientation is expected to be one of ${acceptableValues}. ` + `'${prefs.SimulatorWindowOrientation}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowRotationAngle)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowRotationAngle)) {
        _logger.default.errorAndThrow(`SimulatorWindowRotationAngle is expected to be a valid number. ` + `'${prefs.SimulatorWindowRotationAngle}' is assigned instead.`);
      }
    }
  }
  async updatePreferences(devicePrefs = {}, commonPrefs = {}) {
    if (!_lodash.default.isEmpty(devicePrefs)) {
      _logger.default.debug(`Setting preferences of ${this.udid} Simulator to ${JSON.stringify(devicePrefs)}`);
    }
    if (!_lodash.default.isEmpty(commonPrefs)) {
      _logger.default.debug(`Setting common Simulator preferences to ${JSON.stringify(commonPrefs)}`);
    }
    const homeFolderPath = process.env.HOME;
    if (!homeFolderPath) {
      _logger.default.warn(`Cannot get the path to HOME folder from the process environment. ` + `Ignoring Simulator preferences update.`);
      return false;
    }
    this.verifyDevicePreferences(devicePrefs);
    const plistPath = _path.default.resolve(homeFolderPath, 'Library', 'Preferences', 'com.apple.iphonesimulator.plist');
    return await preferencesPlistGuard.acquire(SimulatorXcode9.name, async () => {
      const defaults = new _defaultsUtils.NSUserDefaults(plistPath);
      const prefsToUpdate = _lodash.default.clone(commonPrefs);
      try {
        if (!_lodash.default.isEmpty(devicePrefs)) {
          let existingDevicePrefs;
          const udidKey = this.udid.toUpperCase();
          if (await _support.fs.exists(plistPath)) {
            const currentPlistContent = await defaults.asJson();
            if (_lodash.default.isPlainObject(currentPlistContent.DevicePreferences) && _lodash.default.isPlainObject(currentPlistContent.DevicePreferences[udidKey])) {
              existingDevicePrefs = currentPlistContent.DevicePreferences[udidKey];
            }
          }
          Object.assign(prefsToUpdate, {
            DevicePreferences: {
              [udidKey]: Object.assign({}, existingDevicePrefs || {}, devicePrefs)
            }
          });
        }
        await defaults.update(prefsToUpdate);
        _logger.default.debug(`Updated ${this.udid} Simulator preferences at '${plistPath}' with ` + JSON.stringify(prefsToUpdate));
        return true;
      } catch (e) {
        _logger.default.warn(`Cannot update ${this.udid} Simulator preferences at '${plistPath}'. ` + `Try to delete the file manually in order to reset it. Original error: ${e.message}`);
        return false;
      }
    });
  }
  async _activateWindow() {
    let selfName;
    let selfSdk;
    let bootedDevicesCount = 0;
    for (const [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (const {
        state,
        udid,
        name
      } of deviceArr) {
        if (state === 'Booted') {
          bootedDevicesCount++;
        }
        if (!selfName && udid === this.udid) {
          selfSdk = sdk;
          selfName = name;
        }
      }
    }
    if (bootedDevicesCount < 2) {
      return await super._activateWindow();
    }
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
          click (menu item 1 where (its name contains "${selfName} " and its name contains "${selfSdk}")) of menu 1 of menu bar item "Window" of menu bar 1
        end tell
      end tell
    `;
  }
  async isBiometricEnrolled() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['notifyutil', '-g', ENROLLMENT_NOTIFICATION_RECEIVER]);
    const match = new RegExp(`${_lodash.default.escapeRegExp(ENROLLMENT_NOTIFICATION_RECEIVER)}\\s+([01])`).exec(stdout);
    if (!match) {
      throw new Error(`Cannot parse biometric enrollment state from '${stdout}'`);
    }
    _logger.default.info(`Current biometric enrolled state for ${this.udid} Simulator: ${match[1]}`);
    return match[1] === '1';
  }
  async enrollBiometric(isEnabled = true) {
    _logger.default.debug(`Setting biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);
    await this.simctl.spawnProcess(['notifyutil', '-s', ENROLLMENT_NOTIFICATION_RECEIVER, isEnabled ? '1' : '0']);
    await this.simctl.spawnProcess(['notifyutil', '-p', ENROLLMENT_NOTIFICATION_RECEIVER]);
    if ((await this.isBiometricEnrolled()) !== isEnabled) {
      throw new Error(`Cannot set biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);
    }
  }
  async sendBiometricMatch(shouldMatch = true, biometricName = 'touchId') {
    const domainComponent = (0, _utils.toBiometricDomainComponent)(biometricName);
    const domain = `com.apple.BiometricKit_Sim.${domainComponent}.${shouldMatch ? '' : 'no'}match`;
    await this.simctl.spawnProcess(['notifyutil', '-p', domain]);
    _logger.default.info(`Sent notification ${domain} to ${shouldMatch ? 'match' : 'not match'} ${biometricName} biometric ` + `for ${this.udid} Simulator`);
  }
  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/LaunchDaemons');
  }
  async configureLocalization(opts = {}) {
    if (_lodash.default.isEmpty(opts)) {
      return false;
    }
    const {
      language,
      locale,
      keyboard
    } = opts;
    const globalPrefs = {};
    let keyboardId = null;
    if (_lodash.default.isPlainObject(keyboard)) {
      const {
        name,
        layout,
        hardware
      } = keyboard;
      if (!name) {
        throw new Error(`The 'keyboard' field must have a valid name set`);
      }
      if (!layout) {
        throw new Error(`The 'keyboard' field must have a valid layout set`);
      }
      keyboardId = `${name}@sw=${layout}`;
      if (hardware) {
        keyboardId += `;@hw=${hardware}`;
      }
      globalPrefs.AppleKeyboards = [keyboardId];
    }
    if (_lodash.default.isPlainObject(language)) {
      const {
        name
      } = language;
      if (!name) {
        throw new Error(`The 'language' field must have a valid name set`);
      }
      globalPrefs.AppleLanguages = [name];
    }
    if (_lodash.default.isPlainObject(locale)) {
      const {
        name,
        calendar
      } = locale;
      if (!name) {
        throw new Error(`The 'locale' field must have a valid name set`);
      }
      let localeId = name;
      if (calendar) {
        localeId += `@calendar=${calendar}`;
      }
      globalPrefs.AppleLocale = localeId;
    }
    if (_lodash.default.isEmpty(globalPrefs)) {
      return false;
    }
    const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)(globalPrefs, true);
    await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', '.GlobalPreferences.plist', ...args])));
    if (keyboardId) {
      const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)({
        KeyboardsCurrentAndNext: [keyboardId],
        KeyboardLastUsed: keyboardId,
        KeyboardLastUsedForLanguage: {
          [keyboard.name]: keyboardId
        }
      }, true);
      await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', 'com.apple.Preferences', ...args])));
    }
    return true;
  }
}
var _default = SimulatorXcode9;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2ltdWxhdG9yWGNvZGUiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9sb2Rhc2giLCJfcGF0aCIsIl9zdXBwb3J0IiwiX2FzeW5jTG9jayIsIl9sb2dnZXIiLCJfYXN5bmNib3giLCJfdXRpbHMiLCJfZGVmYXVsdHNVdGlscyIsIl9ibHVlYmlyZCIsIl9ldmVudHMiLCJfYXBwaXVtWGNvZGUiLCJfdGVlbl9wcm9jZXNzIiwiU0lNVUxBVE9SX1NIVVRET1dOX1RJTUVPVVQiLCJzdGFydHVwTG9jayIsIkFzeW5jTG9jayIsInByZWZlcmVuY2VzUGxpc3RHdWFyZCIsIkVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSIiwiRE9NQUlOX0tFWUJPQVJEX1BSRUZFUkVOQ0VTIiwiY29tcGlsZVNpbXVsYXRvclByZWZlcmVuY2VzIiwib3B0cyIsImNvbm5lY3RIYXJkd2FyZUtleWJvYXJkIiwidHJhY2VQb2ludGVyIiwicGFzdGVib2FyZEF1dG9tYXRpY1N5bmMiLCJzY2FsZUZhY3RvciIsImNvbW1vblByZWZlcmVuY2VzIiwiUm90YXRlV2luZG93V2hlblNpZ25hbGVkQnlHdWVzdCIsIlN0YXJ0TGFzdERldmljZU9uTGF1bmNoIiwiRGV0YWNoT25XaW5kb3dDbG9zZSIsIkF0dGFjaEJvb3RlZE9uU3RhcnQiLCJkZXZpY2VQcmVmZXJlbmNlcyIsIl8iLCJjbG9uZURlZXAiLCJTaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUiLCJwYXJzZUZsb2F0IiwiaXNCb29sZWFuIiwiaXNOaWwiLCJDb25uZWN0SGFyZHdhcmVLZXlib2FyZCIsIlNob3dTaW5nbGVUb3VjaGVzIiwiU2hvd1BpbmNoZXMiLCJTaG93UGluY2hQaXZvdFBvaW50IiwiSGlnaGxpZ2h0RWRnZUdlc3R1cmVzIiwibG93ZXJDYXNlIiwiUGFzdGVib2FyZEF1dG9tYXRpY1N5bmMiLCJsb2ciLCJpbmZvIiwiU2ltdWxhdG9yWGNvZGU5IiwiU2ltdWxhdG9yWGNvZGU4IiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwicnVuIiwiZGVmYXVsdHNEZWVwIiwiaXNIZWFkbGVzcyIsInN0YXJ0dXBUaW1lb3V0IiwidXBkYXRlUHJlZmVyZW5jZXMiLCJ0aW1lciIsInRpbWluZyIsIlRpbWVyIiwic3RhcnQiLCJzaG91bGRXYWl0Rm9yQm9vdCIsImFjcXVpcmUiLCJ1aUNsaWVudEJ1bmRsZUlkIiwiaXNTZXJ2ZXJSdW5uaW5nIiwiaXNSdW5uaW5nIiwidWlDbGllbnRQaWQiLCJnZXRVSUNsaWVudFBpZCIsImtpbGxVSUNsaWVudCIsInBpZCIsIndhaXRGb3JDb25kaXRpb24iLCJpc1NodXRkb3duIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImUiLCJFcnJvciIsImJvb3QiLCJzaHV0ZG93biIsInRpbWVvdXQiLCJsYXVuY2hXaW5kb3ciLCJ3YWl0Rm9yQm9vdCIsImdldER1cmF0aW9uIiwiYXNTZWNvbmRzIiwidG9GaXhlZCIsImRpc2FibGVLZXlib2FyZEludHJvZHVjdGlvbiIsIm1lc3NhZ2UiLCJzdGFydFVJQ2xpZW50Iiwic2ltdWxhdG9yQXBwIiwicGF0aCIsInJlc29sdmUiLCJnZXRYY29kZVBhdGgiLCJTSU1VTEFUT1JfQVBQX05BTUUiLCJhcmdzIiwidXRpbCIsInF1b3RlIiwiZXhlYyIsImVyciIsInN0ZGVyciIsInN0ZG91dCIsImFyZ0NodW5rcyIsImdlbmVyYXRlRGVmYXVsdHNDb21tYW5kQXJncyIsIkRpZFNob3dDb250aW51b3VzUGF0aEludHJvZHVjdGlvbiIsIkIiLCJhbGwiLCJtYXAiLCJzaW1jdGwiLCJzcGF3blByb2Nlc3MiLCJpc1VpQ2xpZW50UnVubmluZyIsImJvb3RFdmVudHNFbWl0dGVyIiwiRXZlbnRFbWl0dGVyIiwic3RhcnRCb290TW9uaXRvciIsIm9uRXJyb3IiLCJlbWl0Iiwib25GaW5pc2hlZCIsInNob3VsZFByZWJvb3QiLCJyZWplY3QiLCJzZXRUaW1lb3V0Iiwib25jZSIsImluY2x1ZGVzIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwidmVyaWZ5RGV2aWNlUHJlZmVyZW5jZXMiLCJwcmVmcyIsImlzRW1wdHkiLCJpc1VuZGVmaW5lZCIsImlzTnVtYmVyIiwiZXJyb3JBbmRUaHJvdyIsIlNpbXVsYXRvcldpbmRvd0NlbnRlciIsInZlcmlmaWNhdGlvblBhdHRlcm4iLCJpc1N0cmluZyIsInRlc3QiLCJTaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbiIsImFjY2VwdGFibGVWYWx1ZXMiLCJpbmRleE9mIiwiU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZSIsImRldmljZVByZWZzIiwiY29tbW9uUHJlZnMiLCJkZWJ1ZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJob21lRm9sZGVyUGF0aCIsInByb2Nlc3MiLCJlbnYiLCJIT01FIiwid2FybiIsInBsaXN0UGF0aCIsIm5hbWUiLCJkZWZhdWx0cyIsIk5TVXNlckRlZmF1bHRzIiwicHJlZnNUb1VwZGF0ZSIsImNsb25lIiwiZXhpc3RpbmdEZXZpY2VQcmVmcyIsInVkaWRLZXkiLCJ0b1VwcGVyQ2FzZSIsImZzIiwiZXhpc3RzIiwiY3VycmVudFBsaXN0Q29udGVudCIsImFzSnNvbiIsImlzUGxhaW5PYmplY3QiLCJEZXZpY2VQcmVmZXJlbmNlcyIsIk9iamVjdCIsImFzc2lnbiIsInVwZGF0ZSIsIl9hY3RpdmF0ZVdpbmRvdyIsInNlbGZOYW1lIiwic2VsZlNkayIsImJvb3RlZERldmljZXNDb3VudCIsInNkayIsImRldmljZUFyciIsInRvUGFpcnMiLCJnZXREZXZpY2VzIiwic3RhdGUiLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwibWF0Y2giLCJSZWdFeHAiLCJlc2NhcGVSZWdFeHAiLCJlbnJvbGxCaW9tZXRyaWMiLCJpc0VuYWJsZWQiLCJzZW5kQmlvbWV0cmljTWF0Y2giLCJzaG91bGRNYXRjaCIsImJpb21ldHJpY05hbWUiLCJkb21haW5Db21wb25lbnQiLCJ0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudCIsImRvbWFpbiIsImdldExhdW5jaERhZW1vbnNSb290IiwiZGV2Um9vdCIsImdldERldmVsb3BlclJvb3QiLCJjb25maWd1cmVMb2NhbGl6YXRpb24iLCJsYW5ndWFnZSIsImxvY2FsZSIsImtleWJvYXJkIiwiZ2xvYmFsUHJlZnMiLCJrZXlib2FyZElkIiwibGF5b3V0IiwiaGFyZHdhcmUiLCJBcHBsZUtleWJvYXJkcyIsIkFwcGxlTGFuZ3VhZ2VzIiwiY2FsZW5kYXIiLCJsb2NhbGVJZCIsIkFwcGxlTG9jYWxlIiwiS2V5Ym9hcmRzQ3VycmVudEFuZE5leHQiLCJLZXlib2FyZExhc3RVc2VkIiwiS2V5Ym9hcmRMYXN0VXNlZEZvckxhbmd1YWdlIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9zaW11bGF0b3IteGNvZGUtOS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2ltdWxhdG9yWGNvZGU4IGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZnMsIHRpbWluZywgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgQXN5bmNMb2NrIGZyb20gJ2FzeW5jLWxvY2snO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHtcbiAgdG9CaW9tZXRyaWNEb21haW5Db21wb25lbnQsIGdldERldmVsb3BlclJvb3QsIFNJTVVMQVRPUl9BUFBfTkFNRVxufSBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7IE5TVXNlckRlZmF1bHRzLCBnZW5lcmF0ZURlZmF1bHRzQ29tbWFuZEFyZ3MgfSBmcm9tICcuL2RlZmF1bHRzLXV0aWxzJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgeyBnZXRQYXRoIGFzIGdldFhjb2RlUGF0aCB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcblxuY29uc3QgU0lNVUxBVE9SX1NIVVRET1dOX1RJTUVPVVQgPSAxNSAqIDEwMDA7XG5jb25zdCBzdGFydHVwTG9jayA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IHByZWZlcmVuY2VzUGxpc3RHdWFyZCA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IEVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSID0gJ2NvbS5hcHBsZS5CaW9tZXRyaWNLaXQuZW5yb2xsbWVudENoYW5nZWQnO1xuY29uc3QgRE9NQUlOX0tFWUJPQVJEX1BSRUZFUkVOQ0VTID0gJ2NvbS5hcHBsZS5rZXlib2FyZC5wcmVmZXJlbmNlcyc7XG5cbi8qKlxuICogQ3JlYXRlcyBkZXZpY2UgYW5kIGNvbW1vbiBTaW11bGF0b3IgcHJlZmVyZW5jZXMsIHdoaWNoIGNvdWxkXG4gKiBiZSBsYXRlciBhcHBsaWVkIHVzaW5nIGBkZWZhdWx0c2AgQ0xJIHV0aWxpdHkuXG4gKlxuICogQHBhcmFtIHtSdW5PcHRpb25zfSBvcHRzXG4gKiBAcmV0dXJucyB7b2JqZWN0W119IFRoZSBmaXJzdCBhcnJheSBpdGVtIGlzIHRoZSByZXN1bHRpbmcgZGV2aWNlIHByZWZlcmVuY2VzXG4gKiBvYmplY3QgYW5kIHRoZSBzZWNvbmQgb25lIGlzIGNvbW1vbiBwcmVmZXJlbmNlcyBvYmplY3RcbiAqL1xuZnVuY3Rpb24gY29tcGlsZVNpbXVsYXRvclByZWZlcmVuY2VzIChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGNvbm5lY3RIYXJkd2FyZUtleWJvYXJkLFxuICAgIHRyYWNlUG9pbnRlcixcbiAgICBwYXN0ZWJvYXJkQXV0b21hdGljU3luYyxcbiAgICBzY2FsZUZhY3RvcixcbiAgfSA9IG9wdHM7XG4gIGNvbnN0IGNvbW1vblByZWZlcmVuY2VzID0ge1xuICAgIC8vIFRoaXMgb3B0aW9uIGlzIG5lY2Vzc2FyeSB0byBtYWtlIHRoZSBTaW11bGF0b3Igd2luZG93IGZvbGxvd1xuICAgIC8vIHRoZSBhY3R1YWwgWENVSURldmljZSBvcmllbnRhdGlvblxuICAgIFJvdGF0ZVdpbmRvd1doZW5TaWduYWxlZEJ5R3Vlc3Q6IHRydWUsXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzE2NDE4XG4gICAgU3RhcnRMYXN0RGV2aWNlT25MYXVuY2g6IGZhbHNlLFxuICAgIERldGFjaE9uV2luZG93Q2xvc2U6IGZhbHNlLFxuICAgIEF0dGFjaEJvb3RlZE9uU3RhcnQ6IHRydWUsXG4gIH07XG4gIGNvbnN0IGRldmljZVByZWZlcmVuY2VzID0gb3B0cy5kZXZpY2VQcmVmZXJlbmNlcyA/IF8uY2xvbmVEZWVwKG9wdHMuZGV2aWNlUHJlZmVyZW5jZXMpIDoge307XG4gIGlmIChzY2FsZUZhY3Rvcikge1xuICAgIGRldmljZVByZWZlcmVuY2VzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSA9IHBhcnNlRmxvYXQoc2NhbGVGYWN0b3IpO1xuICB9XG4gIGlmIChfLmlzQm9vbGVhbihjb25uZWN0SGFyZHdhcmVLZXlib2FyZCkgfHwgXy5pc05pbChjb25uZWN0SGFyZHdhcmVLZXlib2FyZCkpIHtcbiAgICBkZXZpY2VQcmVmZXJlbmNlcy5Db25uZWN0SGFyZHdhcmVLZXlib2FyZCA9IGNvbm5lY3RIYXJkd2FyZUtleWJvYXJkID8/IGZhbHNlO1xuICAgIGNvbW1vblByZWZlcmVuY2VzLkNvbm5lY3RIYXJkd2FyZUtleWJvYXJkID0gY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgPz8gZmFsc2U7XG4gIH1cbiAgaWYgKF8uaXNCb29sZWFuKHRyYWNlUG9pbnRlcikpIHtcbiAgICBjb21tb25QcmVmZXJlbmNlcy5TaG93U2luZ2xlVG91Y2hlcyA9IHRyYWNlUG9pbnRlcjtcbiAgICBjb21tb25QcmVmZXJlbmNlcy5TaG93UGluY2hlcyA9IHRyYWNlUG9pbnRlcjtcbiAgICBjb21tb25QcmVmZXJlbmNlcy5TaG93UGluY2hQaXZvdFBvaW50ID0gdHJhY2VQb2ludGVyO1xuICAgIGNvbW1vblByZWZlcmVuY2VzLkhpZ2hsaWdodEVkZ2VHZXN0dXJlcyA9IHRyYWNlUG9pbnRlcjtcbiAgfVxuICBzd2l0Y2ggKF8ubG93ZXJDYXNlKHBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jKSkge1xuICAgIGNhc2UgJ29uJzpcbiAgICAgIGNvbW1vblByZWZlcmVuY2VzLlBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ29mZic6XG4gICAgICAvLyBJbXByb3ZlIGxhdW5jaGluZyBzaW11bGF0b3IgcGVyZm9ybWFuY2VcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9XZWJLaXQvd2Via2l0L2Jsb2IvbWFzdGVyL1Rvb2xzL1NjcmlwdHMvd2Via2l0cHkveGNvZGUvc2ltdWxhdGVkX2RldmljZS5weSNMNDEzXG4gICAgICBjb21tb25QcmVmZXJlbmNlcy5QYXN0ZWJvYXJkQXV0b21hdGljU3luYyA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3lzdGVtJzpcbiAgICAgIC8vIERvIG5vdCBhZGQgLVBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jXG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbG9nLmluZm8oYFsnb24nLCAnb2ZmJyBvciAnc3lzdGVtJ10gYXJlIGF2YWlsYWJsZSBhcyB0aGUgcGFzdGVib2FyZCBhdXRvbWF0aWMgc3luYyBvcHRpb24uIERlZmF1bHRpbmcgdG8gJ29mZidgKTtcbiAgICAgIGNvbW1vblByZWZlcmVuY2VzLlBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jID0gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIFtkZXZpY2VQcmVmZXJlbmNlcywgY29tbW9uUHJlZmVyZW5jZXNdO1xufVxuXG5jbGFzcyBTaW11bGF0b3JYY29kZTkgZXh0ZW5kcyBTaW11bGF0b3JYY29kZTgge1xuICBjb25zdHJ1Y3RvciAodWRpZCwgeGNvZGVWZXJzaW9uKSB7XG4gICAgc3VwZXIodWRpZCwgeGNvZGVWZXJzaW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBEZXZpY2VQcmVmZXJlbmNlc1xuICAgKiBAcHJvcGVydHkgez9udW1iZXJ9IFNpbXVsYXRvckV4dGVybmFsRGlzcGxheSAtIFRCRC4gRXhhbXBsZSB2YWx1ZTogMi4xMTRcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBDaHJvbWVUaW50IC0gVEJELiBFeGFtcGxlIHZhbHVlOiAnJ1xuICAgKiBAcHJvcGVydHkgez9udW1iZXJ9IFNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSAtIFNjYWxlIHZhbHVlIGZvciB0aGUgcGFydGljdWxhciBTaW11bGF0b3Igd2luZG93LlxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEuMCBtZWFucyAxMDAlIHNjYWxlLlxuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IFNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uIC0gU2ltdWxhdG9yIHdpbmRvdyBvcmllbnRhdGlvbi4gUG9zc2libGUgdmFsdWVzIGFyZTpcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQb3J0cmFpdCcsICdMYW5kc2NhcGVMZWZ0JywgJ1BvcnRyYWl0VXBzaWRlRG93bicgYW5kICdMYW5kc2NhcGVSaWdodCcuXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcn0gU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZSAtIFdpbmRvdyByb3RhdGlvbiBhbmdsZS4gVGhpcyB2YWx1ZSBpcyBleHBlY3RlZCB0byBiZSBpbiBzeW5jXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggX1NpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uXy4gVGhlIGNvcnJlc3BvbmRpbmcgdmFsdWVzIGFyZTpcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgOTAsIDE4MCBhbmQgMjcwLlxuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IFNpbXVsYXRvcldpbmRvd0NlbnRlciAtIFRoZSBjb29yZGluYXRlcyBvZiBTaW11bGF0b3IncyB3aW5kb3cgY2VudGVyIGluIHBpeGVscyxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAney0xMjk0LjUsIDc3NS41fScuXG4gICAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IENvbm5lY3RIYXJkd2FyZUtleWJvYXJkIC0gRXF1YWxzIHRvIDEgaWYgaGFyZHdhcmUga2V5Ym9hcmQgc2hvdWxkIGJlIGNvbm5lY3RlZC5cbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPdGhlcndpc2UgMC5cbiAgICovXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvbW1vblByZWZlcmVuY2VzXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gQ29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgLSBXaGV0aGVyIHRvIGNvbm5lY3QgaGFyZHdhcmUga2V5Ym9hcmRcbiAgICovXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFJ1bk9wdGlvbnNcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHNjYWxlRmFjdG9yOiBBbnkgcG9zaXRpdmUgZmxvYXQgdmFsdWUuIDEuMCBtZWFucyAxOjEgc2NhbGUuXG4gICAqIERlZmluZXMgdGhlIHdpbmRvdyBzY2FsZSB2YWx1ZSBmb3IgdGhlIFVJIGNsaWVudCB3aW5kb3cgZm9yIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICogRXF1YWxzIHRvIGBudWxsYCBieSBkZWZhdWx0LCB3aGljaCBrZWVwcyB0aGUgY3VycmVudCBzY2FsZSB1bmNoYW5nZWQuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQ6IHdoZXRoZXIgdG8gY29ubmVjdCB0aGUgaGFyZHdhcmUga2V5Ym9hcmQgdG8gdGhlXG4gICAqIFNpbXVsYXRvciBVSSBjbGllbnQuIEVxdWFscyB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydHVwVGltZW91dDogbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nXG4gICAqIHByb2Nlc3MgaXMgY29tcGxldGVkLiBUaGUgZGVmYXVsdCB0aW1lb3V0IHdpbGwgYmUgdXNlZCBpZiBub3Qgc2V0IGV4cGxpY2l0bHkuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNIZWFkbGVzczogd2hldGhlciB0byBzdGFydCB0aGUgU2ltdWxhdG9yIGluIGhlYWRsZXNzIG1vZGUgKHdpdGggVUlcbiAgICogY2xpZW50IGludmlzaWJsZSkuIGBmYWxzZWAgYnkgZGVmYXVsdC5cbiAgICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gdHJhY2VQb2ludGVyIFtmYWxzZV0gLSBXaGV0aGVyIHRvIGhpZ2hsaWdodCB0b3VjaGVzIG9uIFNpbXVsYXRvclxuICAgKiBzY3JlZW4uIFRoaXMgaXMgaGVscGZ1bCB3aGlsZSBkZWJ1Z2dpbmcgYXV0b21hdGVkIHRlc3RzIG9yIHdoaWxlIG9ic2VydmluZyB0aGUgYXV0b21hdGlvblxuICAgKiByZWNvcmRpbmdzLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGFzdGVib2FyZEF1dG9tYXRpY1N5bmMgWydvZmYnXSAtIFdoZXRoZXIgdG8gZGlzYWJsZSBwYXN0ZWJvYXJkIHN5bmMgd2l0aCB0aGVcbiAgICogU2ltdWxhdG9yIFVJIGNsaWVudCBvciByZXNwZWN0IHRoZSBzeXN0ZW0gd2lkZSBwcmVmZXJlbmNlLiAnb24nLCAnb2ZmJywgb3IgJ3N5c3RlbScgaXMgYXZhaWxhYmxlLlxuICAgKiBUaGUgc3luYyBpbmNyZWFzZXMgbGF1bmNoaW5nIHNpbXVsYXRvciBwcm9jZXNzIHRpbWUsIGJ1dCBpdCBhbGxvd3Mgc3lzdGVtIHRvIHN5bmMgcGFzdGVib2FyZFxuICAgKiB3aXRoIHNpbXVsYXRvcnMuIEZvbGxvd3Mgc3lzdGVtLXdpZGUgcHJlZmVyZW5jZSBpZiB0aGUgdmFsdWUgaXMgJ3N5c3RlbScuXG4gICAqIERlZmF1bHRzIHRvICdvZmYnLlxuICAgKiBAcHJvcGVydHkge0RldmljZVByZWZlcmVuY2VzfSBkZXZpY2VQcmVmZXJlbmNlczogcHJlZmVyZW5jZXMgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgU2ltdWxhdG9yXG4gICAqIGRldmljZVxuICAgKi9cblxuICAvKipcbiAgICogRXhlY3V0ZXMgZ2l2ZW4gU2ltdWxhdG9yIHdpdGggb3B0aW9ucy4gVGhlIFNpbXVsYXRvciB3aWxsIG5vdCBiZSByZXN0YXJ0ZWQgaWZcbiAgICogaXQgaXMgYWxyZWFkeSBydW5uaW5nIGFuZCB0aGUgY3VycmVudCBVSSBzdGF0ZSBtYXRjaGVzIHRvIGBpc0hlYWRsZXNzYCBvcHRpb24uXG4gICAqIEBvdmVycmlkZVxuICAgKlxuICAgKiBAcGFyYW0ge1J1bk9wdGlvbnN9IG9wdHMgLSBPbmUgb3IgbW9yZSBvZiBhdmFpbGFibGUgU2ltdWxhdG9yIG9wdGlvbnNcbiAgICovXG4gIGFzeW5jIHJ1biAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IF8uY2xvbmVEZWVwKG9wdHMpO1xuICAgIF8uZGVmYXVsdHNEZWVwKG9wdHMsIHtcbiAgICAgIGlzSGVhZGxlc3M6IGZhbHNlLFxuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBbZGV2aWNlUHJlZmVyZW5jZXMsIGNvbW1vblByZWZlcmVuY2VzXSA9IGNvbXBpbGVTaW11bGF0b3JQcmVmZXJlbmNlcyhvcHRzKTtcbiAgICBhd2FpdCB0aGlzLnVwZGF0ZVByZWZlcmVuY2VzKGRldmljZVByZWZlcmVuY2VzLCBjb21tb25QcmVmZXJlbmNlcyk7XG5cbiAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgIGNvbnN0IHNob3VsZFdhaXRGb3JCb290ID0gYXdhaXQgc3RhcnR1cExvY2suYWNxdWlyZSh0aGlzLnVpQ2xpZW50QnVuZGxlSWQsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgICBjb25zdCB1aUNsaWVudFBpZCA9IGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKTtcbiAgICAgIGlmIChvcHRzLmlzSGVhZGxlc3MpIHtcbiAgICAgICAgaWYgKGlzU2VydmVyUnVubmluZyAmJiAhdWlDbGllbnRQaWQpIHtcbiAgICAgICAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIHdpdGggVURJRCAnJHt0aGlzLnVkaWR9JyBpcyBhbHJlYWR5IGJvb3RlZCBpbiBoZWFkbGVzcyBtb2RlLmApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXdhaXQgdGhpcy5raWxsVUlDbGllbnQoe3BpZDogdWlDbGllbnRQaWR9KSkge1xuICAgICAgICAgIGxvZy5pbmZvKGBEZXRlY3RlZCB0aGUgU2ltdWxhdG9yIFVJIGNsaWVudCB3YXMgcnVubmluZyBhbmQga2lsbGVkIGl0LiBWZXJpZnlpbmcgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIHN0YXRlYCk7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBTdG9wcGluZyB0aGUgVUkgY2xpZW50IGtpbGxzIGFsbCBydW5uaW5nIHNlcnZlcnMgZm9yIHNvbWUgZWFybHkgWENvZGUgdmVyc2lvbnMuIFRoaXMgaXMgYSBrbm93biBidWdcbiAgICAgICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpLCB7XG4gICAgICAgICAgICB3YWl0TXM6IDUwMDAsXG4gICAgICAgICAgICBpbnRlcnZhbE1zOiAxMDAsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoIWF3YWl0IHRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU2ltdWxhdG9yIHdpdGggVURJRCAnJHt0aGlzLnVkaWR9JyBjYW5ub3QgYmUgdHJhbnNpdGlvbmVkIHRvIGhlYWRsZXNzIG1vZGVgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGxvZy5pbmZvKGBCb290aW5nIFNpbXVsYXRvciB3aXRoIFVESUQgJyR7dGhpcy51ZGlkfScgaW4gaGVhZGxlc3MgbW9kZS4gYCArXG4gICAgICAgICAgYEFsbCBVSS1yZWxhdGVkIGNhcGFiaWxpdGllcyBhcmUgZ29pbmcgdG8gYmUgaWdub3JlZGApO1xuICAgICAgICBhd2FpdCB0aGlzLmJvb3QoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgdWlDbGllbnRQaWQpIHtcbiAgICAgICAgICBsb2cuaW5mbyhgQm90aCBTaW11bGF0b3Igd2l0aCBVRElEICcke3RoaXMudWRpZH0nIGFuZCB0aGUgVUkgY2xpZW50IGFyZSBjdXJyZW50bHkgcnVubmluZ2ApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFNpbXVsYXRvciAnJHt0aGlzLnVkaWR9JyBpcyBib290ZWQgd2hpbGUgaXRzIFVJIGlzIG5vdCB2aXNpYmxlLiBgICtcbiAgICAgICAgICAgIGBUcnlpbmcgdG8gcmVzdGFydCBpdCB3aXRoIHRoZSBTaW11bGF0b3Igd2luZG93IHZpc2libGVgKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnNodXRkb3duKHt0aW1lb3V0OiBTSU1VTEFUT1JfU0hVVERPV05fVElNRU9VVH0pO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRoaXMubGF1bmNoV2luZG93KHVpQ2xpZW50UGlkLCBvcHRzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgaWYgKHNob3VsZFdhaXRGb3JCb290KSB7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JCb290KG9wdHMuc3RhcnR1cFRpbWVvdXQpO1xuICAgICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGJvb3RlZCBpbiAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNTZWNvbmRzLnRvRml4ZWQoMyl9c2ApO1xuICAgIH1cblxuICAgIChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmRpc2FibGVLZXlib2FyZEludHJvZHVjdGlvbigpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuaW5mbyhgQ2Fubm90IGRpc2FibGUgU2ltdWxhdG9yIGtleWJvYXJkIGludHJvZHVjdGlvbi4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH1cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICBhc3luYyBzdGFydFVJQ2xpZW50IChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gXy5jbG9uZURlZXAob3B0cyk7XG4gICAgXy5kZWZhdWx0c0RlZXAob3B0cywge1xuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzaW11bGF0b3JBcHAgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0WGNvZGVQYXRoKCksICdBcHBsaWNhdGlvbnMnLCBTSU1VTEFUT1JfQVBQX05BTUUpO1xuICAgIGNvbnN0IGFyZ3MgPSBbJy1GbicsIHNpbXVsYXRvckFwcF07XG4gICAgbG9nLmluZm8oYFN0YXJ0aW5nIFNpbXVsYXRvciBVSTogJHt1dGlsLnF1b3RlKFsnb3BlbicsIC4uLmFyZ3NdKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygnb3BlbicsIGFyZ3MsIHt0aW1lb3V0OiBvcHRzLnN0YXJ0dXBUaW1lb3V0fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEdvdCBhbiB1bmV4cGVjdGVkIGVycm9yIHdoaWxlIG9wZW5pbmcgU2ltdWxhdG9yIFVJOiBgICtcbiAgICAgICAgZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzYWJsZSBrZXlib2FyZCB0dXRvcmlhbCBhcyAnY29tLmFwcGxlLmtleWJvYXJkLnByZWZlcmVuY2VzJyBkb21haW4gdmlhICdkZWZhdWx0cycgY29tbWFuZC5cbiAgICovXG4gIGFzeW5jIGRpc2FibGVLZXlib2FyZEludHJvZHVjdGlvbiAoKSB7XG4gICAgY29uc3QgYXJnQ2h1bmtzID0gZ2VuZXJhdGVEZWZhdWx0c0NvbW1hbmRBcmdzKHtcbiAgICAvLyBUbyBkaXNhYmxlICdEaWRTaG93Q29udGludW91c1BhdGhJbnRyb2R1Y3Rpb24nIGZvciBpT1MgMTUrIHNpbXVsYXRvcnMgc2luY2UgY2hhbmdpbmcgdGhlIHByZWZlcmVuY2UgdmlhIFdEQVxuICAgIC8vIGRvZXMgbm90IHdvcmsgb24gdGhlbS4gTG93ZXIgdGhhbiB0aGUgdmVyc2lvbnMgYWxzbyBjYW4gaGF2ZSB0aGlzIHByZWZlcmVuY2UsIGJ1dCBub3RoaW5nIGhhcHBlbi5cbiAgICAgIERpZFNob3dDb250aW51b3VzUGF0aEludHJvZHVjdGlvbjogMVxuICAgIH0sIHRydWUpO1xuICAgIGF3YWl0IEIuYWxsKGFyZ0NodW5rcy5tYXAoKGFyZ3MpID0+IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnZGVmYXVsdHMnLCAnd3JpdGUnLCBET01BSU5fS0VZQk9BUkRfUFJFRkVSRU5DRVMsIC4uLmFyZ3NcbiAgICBdKSkpO1xuICB9XG5cbiAgLyoqKlxuICAgKiBCb290cyBzaW11bGF0b3IgYW5kIG9wZW5zIHNpbXVsYXRvcnMgVUkgQ2xpZW50IGlmIG5vdCBhbHJlYWR5IG9wZW5lZC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpc1VpQ2xpZW50UnVubmluZyAtIHByb2Nlc3MgaWQgb2Ygc2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICogQHBhcmFtIHtSdW5PcHRpb25zfSBvcHRzIC0gYXJndW1lbnRzIHRvIHN0YXJ0IHNpbXVsYXRvciBVSSBjbGllbnQgd2l0aC5cbiAgICovXG4gIGFzeW5jIGxhdW5jaFdpbmRvdyAoaXNVaUNsaWVudFJ1bm5pbmcsIG9wdHMgPSB7fSkge1xuICAgIGF3YWl0IHRoaXMuYm9vdCgpO1xuICAgIGlmICghaXNVaUNsaWVudFJ1bm5pbmcpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRVSUNsaWVudChvcHRzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQm9vdHMgU2ltdWxhdG9yIGlmIG5vdCBhbHJlYWR5IGJvb3RlZC5cbiAgICogRG9lcyBub3RoaW5nIGlmIGl0IGlzIGFscmVhZHkgcnVubmluZy5cbiAgICogVGhpcyBBUEkgZG9lcyBOT1Qgd2FpdCB1bnRpbCBTaW11bGF0b3IgaXMgZnVsbHkgYm9vdGVkLlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGEgZmFpbHVyZSB3aGlsZSBib290aW5nIHRoZSBTaW11bGF0b3IuXG4gICAqL1xuICBhc3luYyBib290ICgpIHtcbiAgICBjb25zdCBib290RXZlbnRzRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5zdGFydEJvb3RNb25pdG9yKHtcbiAgICAgIG9uRXJyb3I6IChlcnIpID0+IGJvb3RFdmVudHNFbWl0dGVyLmVtaXQoJ2ZhaWx1cmUnLCBlcnIpLFxuICAgICAgb25GaW5pc2hlZDogKCkgPT4gYm9vdEV2ZW50c0VtaXR0ZXIuZW1pdCgnZmluaXNoJyksXG4gICAgICBzaG91bGRQcmVib290OiB0cnVlLFxuICAgIH0pO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIC8vIEhpc3RvcmljYWxseSB0aGlzIGNhbGwgd2FzIGFsd2F5cyBhc3luY2hyb25vdXMsXG4gICAgICAgIC8vIGUuZy4gaXQgd2FzIG5vdCB3YWl0aW5nIHVudGlsIFNpbXVsYXRvciBpcyBmdWxseSBib290ZWQuXG4gICAgICAgIC8vIFNvIHdlIHByZXNlcnZlIHRoYXQgYmVoYXZpb3IsIGFuZCBpZiBubyBlcnJvcnMgYXJlIHJlY2VpdmVkIGZvciBhIHdoaWxlXG4gICAgICAgIC8vIHRoZW4gd2UgYXNzdW1lIHRoZSBTaW11bGF0b3IgYm9vdGluZyBpcyBzdGlsbCBpbiBwcm9ncmVzcy5cbiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCAzMDAwKTtcbiAgICAgICAgYm9vdEV2ZW50c0VtaXR0ZXIub25jZSgnZmFpbHVyZScsIChlcnIpID0+IHtcbiAgICAgICAgICBpZiAoXy5pbmNsdWRlcyhlcnI/Lm1lc3NhZ2UsICdzdGF0ZTogQm9vdGVkJykpIHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYm9vdEV2ZW50c0VtaXR0ZXIub25jZSgnZmluaXNoJywgcmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYm9vdEV2ZW50c0VtaXR0ZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gdmVyaWZpY2F0aW9uIG9mIGRldmljZSBwcmVmZXJlbmNlcyBjb3JyZWN0bmVzcy5cbiAgICpcbiAgICogQHBhcmFtIHtEZXZpY2VQcmVmZXJlbmNlc30gcHJlZnMgW3t9XSAtIFRoZSBwcmVmZXJlbmNlcyB0byBiZSB2ZXJpZmllZFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgYW55IG9mIHRoZSBnaXZlbiBwcmVmZXJlbmNlIHZhbHVlcyBkb2VzIG5vdCBtYXRjaCB0aGUgZXhwZWN0ZWRcbiAgICogZm9ybWF0LlxuICAgKi9cbiAgdmVyaWZ5RGV2aWNlUHJlZmVyZW5jZXMgKHByZWZzID0ge30pIHtcbiAgICBpZiAoXy5pc0VtcHR5KHByZWZzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghXy5pc1VuZGVmaW5lZChwcmVmcy5TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUpKSB7XG4gICAgICBpZiAoIV8uaXNOdW1iZXIocHJlZnMuU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlKSB8fCBwcmVmcy5TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUgPD0gMCkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlIGlzIGV4cGVjdGVkIHRvIGJlIGEgcG9zaXRpdmUgZmxvYXQgdmFsdWUuIGAgK1xuICAgICAgICAgIGAnJHtwcmVmcy5TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGV9JyBpcyBhc3NpZ25lZCBpbnN0ZWFkLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghXy5pc1VuZGVmaW5lZChwcmVmcy5TaW11bGF0b3JXaW5kb3dDZW50ZXIpKSB7XG4gICAgICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yLzJaWE9pai8yXG4gICAgICBjb25zdCB2ZXJpZmljYXRpb25QYXR0ZXJuID0gL3stP1xcZCsoXFwuXFxkKyk/LC0/XFxkKyhcXC5cXGQrKT99LztcbiAgICAgIGlmICghXy5pc1N0cmluZyhwcmVmcy5TaW11bGF0b3JXaW5kb3dDZW50ZXIpIHx8ICF2ZXJpZmljYXRpb25QYXR0ZXJuLnRlc3QocHJlZnMuU2ltdWxhdG9yV2luZG93Q2VudGVyKSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgU2ltdWxhdG9yV2luZG93Q2VudGVyIGlzIGV4cGVjdGVkIHRvIG1hdGNoIFwie2Zsb2F0WFBvc2l0aW9uLGZsb2F0WVBvc2l0aW9ufVwiIGZvcm1hdCAod2l0aG91dCBzcGFjZXMpLiBgICtcbiAgICAgICAgICBgJyR7cHJlZnMuU2ltdWxhdG9yV2luZG93Q2VudGVyfScgaXMgYXNzaWduZWQgaW5zdGVhZC5gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQocHJlZnMuU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb24pKSB7XG4gICAgICBjb25zdCBhY2NlcHRhYmxlVmFsdWVzID0gWydQb3J0cmFpdCcsICdMYW5kc2NhcGVMZWZ0JywgJ1BvcnRyYWl0VXBzaWRlRG93bicsICdMYW5kc2NhcGVSaWdodCddO1xuICAgICAgaWYgKGFjY2VwdGFibGVWYWx1ZXMuaW5kZXhPZihwcmVmcy5TaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbikgPT09IC0xKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBTaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbiBpcyBleHBlY3RlZCB0byBiZSBvbmUgb2YgJHthY2NlcHRhYmxlVmFsdWVzfS4gYCArXG4gICAgICAgICAgYCcke3ByZWZzLlNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9ufScgaXMgYXNzaWduZWQgaW5zdGVhZC5gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQocHJlZnMuU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZSkpIHtcbiAgICAgIGlmICghXy5pc051bWJlcihwcmVmcy5TaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlKSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZSBpcyBleHBlY3RlZCB0byBiZSBhIHZhbGlkIG51bWJlci4gYCArXG4gICAgICAgICAgYCcke3ByZWZzLlNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGV9JyBpcyBhc3NpZ25lZCBpbnN0ZWFkLmApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGNvbW1vbiBpT1MgU2ltdWxhdG9yIHByZWZlcmVuY2VzIGZpbGUgd2l0aCBuZXcgdmFsdWVzLlxuICAgKiBJdCBpcyBuZWNlc3NhcnkgdG8gcmVzdGFydCB0aGUgY29ycmVzcG9uZGluZyBTaW11bGF0b3IgYmVmb3JlXG4gICAqIHRoZXNlIGNoYW5nZXMgYXJlIGFwcGxpZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7RGV2aWNlUHJlZmVyZW5jZXN9IGRldmljZVByZWZzIFt7fV0gLSBUaGUgbWFwcGluZywgd2hpY2ggcmVwcmVzZW50cyBuZXcgZGV2aWNlIHByZWZlcmVuY2UgdmFsdWVzXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlIGdpdmVuIFNpbXVsYXRvci5cbiAgICogQHBhcmFtIHtDb21tb25QcmVmZXJlbmNlc30gY29tbW9uUHJlZnMgW3t9XSAtIFRoZSBtYXBwaW5nLCB3aGljaCByZXByZXNlbnRzIG5ldyBjb21tb24gcHJlZmVyZW5jZSB2YWx1ZXNcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBhbGwgU2ltdWxhdG9ycy5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgcHJlZmVyZW5jZXMgd2VyZSBzdWNjZXNzZnVsbHkgdXBkYXRlZC5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVByZWZlcmVuY2VzIChkZXZpY2VQcmVmcyA9IHt9LCBjb21tb25QcmVmcyA9IHt9KSB7XG4gICAgaWYgKCFfLmlzRW1wdHkoZGV2aWNlUHJlZnMpKSB7XG4gICAgICBsb2cuZGVidWcoYFNldHRpbmcgcHJlZmVyZW5jZXMgb2YgJHt0aGlzLnVkaWR9IFNpbXVsYXRvciB0byAke0pTT04uc3RyaW5naWZ5KGRldmljZVByZWZzKX1gKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzRW1wdHkoY29tbW9uUHJlZnMpKSB7XG4gICAgICBsb2cuZGVidWcoYFNldHRpbmcgY29tbW9uIFNpbXVsYXRvciBwcmVmZXJlbmNlcyB0byAke0pTT04uc3RyaW5naWZ5KGNvbW1vblByZWZzKX1gKTtcbiAgICB9XG4gICAgY29uc3QgaG9tZUZvbGRlclBhdGggPSBwcm9jZXNzLmVudi5IT01FO1xuICAgIGlmICghaG9tZUZvbGRlclBhdGgpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgZ2V0IHRoZSBwYXRoIHRvIEhPTUUgZm9sZGVyIGZyb20gdGhlIHByb2Nlc3MgZW52aXJvbm1lbnQuIGAgK1xuICAgICAgICBgSWdub3JpbmcgU2ltdWxhdG9yIHByZWZlcmVuY2VzIHVwZGF0ZS5gKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy52ZXJpZnlEZXZpY2VQcmVmZXJlbmNlcyhkZXZpY2VQcmVmcyk7XG4gICAgY29uc3QgcGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKGhvbWVGb2xkZXJQYXRoLCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUuaXBob25lc2ltdWxhdG9yLnBsaXN0Jyk7XG4gICAgcmV0dXJuIGF3YWl0IHByZWZlcmVuY2VzUGxpc3RHdWFyZC5hY3F1aXJlKFNpbXVsYXRvclhjb2RlOS5uYW1lLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWZhdWx0cyA9IG5ldyBOU1VzZXJEZWZhdWx0cyhwbGlzdFBhdGgpO1xuICAgICAgY29uc3QgcHJlZnNUb1VwZGF0ZSA9IF8uY2xvbmUoY29tbW9uUHJlZnMpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCFfLmlzRW1wdHkoZGV2aWNlUHJlZnMpKSB7XG4gICAgICAgICAgbGV0IGV4aXN0aW5nRGV2aWNlUHJlZnM7XG4gICAgICAgICAgY29uc3QgdWRpZEtleSA9IHRoaXMudWRpZC50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgIGlmIChhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFBsaXN0Q29udGVudCA9IGF3YWl0IGRlZmF1bHRzLmFzSnNvbigpO1xuICAgICAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChjdXJyZW50UGxpc3RDb250ZW50LkRldmljZVByZWZlcmVuY2VzKVxuICAgICAgICAgICAgICAgICYmIF8uaXNQbGFpbk9iamVjdChjdXJyZW50UGxpc3RDb250ZW50LkRldmljZVByZWZlcmVuY2VzW3VkaWRLZXldKSkge1xuICAgICAgICAgICAgICBleGlzdGluZ0RldmljZVByZWZzID0gY3VycmVudFBsaXN0Q29udGVudC5EZXZpY2VQcmVmZXJlbmNlc1t1ZGlkS2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihwcmVmc1RvVXBkYXRlLCB7XG4gICAgICAgICAgICBEZXZpY2VQcmVmZXJlbmNlczoge1xuICAgICAgICAgICAgICBbdWRpZEtleV06IE9iamVjdC5hc3NpZ24oe30sIGV4aXN0aW5nRGV2aWNlUHJlZnMgfHwge30sIGRldmljZVByZWZzKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGRlZmF1bHRzLnVwZGF0ZShwcmVmc1RvVXBkYXRlKTtcbiAgICAgICAgbG9nLmRlYnVnKGBVcGRhdGVkICR7dGhpcy51ZGlkfSBTaW11bGF0b3IgcHJlZmVyZW5jZXMgYXQgJyR7cGxpc3RQYXRofScgd2l0aCBgICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShwcmVmc1RvVXBkYXRlKSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cud2FybihgQ2Fubm90IHVwZGF0ZSAke3RoaXMudWRpZH0gU2ltdWxhdG9yIHByZWZlcmVuY2VzIGF0ICcke3BsaXN0UGF0aH0nLiBgICtcbiAgICAgICAgICBgVHJ5IHRvIGRlbGV0ZSB0aGUgZmlsZSBtYW51YWxseSBpbiBvcmRlciB0byByZXNldCBpdC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICogQG92ZXJyaWRlXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhc3luYyBfYWN0aXZhdGVXaW5kb3cgKCkge1xuICAgIGxldCBzZWxmTmFtZTtcbiAgICBsZXQgc2VsZlNkaztcbiAgICBsZXQgYm9vdGVkRGV2aWNlc0NvdW50ID0gMDtcbiAgICBmb3IgKGNvbnN0IFtzZGssIGRldmljZUFycl0gb2YgXy50b1BhaXJzKGF3YWl0IHRoaXMuc2ltY3RsLmdldERldmljZXMoKSkpIHtcbiAgICAgIGZvciAoY29uc3Qge3N0YXRlLCB1ZGlkLCBuYW1lfSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKHN0YXRlID09PSAnQm9vdGVkJykge1xuICAgICAgICAgIGJvb3RlZERldmljZXNDb3VudCsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc2VsZk5hbWUgJiYgdWRpZCA9PT0gdGhpcy51ZGlkKSB7XG4gICAgICAgICAgc2VsZlNkayA9IHNkaztcbiAgICAgICAgICBzZWxmTmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGJvb3RlZERldmljZXNDb3VudCA8IDIpIHtcbiAgICAgIHJldHVybiBhd2FpdCBzdXBlci5fYWN0aXZhdGVXaW5kb3coKTtcbiAgICB9XG5cbiAgICAvLyBUaGVyZSBhcmUgcG90ZW50aWFsbHkgbW9yZSB0aGF0IG9uZSBTaW11bGF0b3Igd2luZG93XG4gICAgcmV0dXJuIGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIGZhbHNlXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byB0cnVlXG4gICAgICAgICAgY2xpY2sgKG1lbnUgaXRlbSAxIHdoZXJlIChpdHMgbmFtZSBjb250YWlucyBcIiR7c2VsZk5hbWV9IFwiIGFuZCBpdHMgbmFtZSBjb250YWlucyBcIiR7c2VsZlNka31cIikpIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiV2luZG93XCIgb2YgbWVudSBiYXIgMVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqIEBvdmVycmlkZVxuICAgKi9cbiAgYXN5bmMgaXNCaW9tZXRyaWNFbnJvbGxlZCAoKSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ25vdGlmeXV0aWwnLFxuICAgICAgJy1nJywgRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVJcbiAgICBdKTtcbiAgICBjb25zdCBtYXRjaCA9IChuZXcgUmVnRXhwKGAke18uZXNjYXBlUmVnRXhwKEVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSKX1cXFxccysoWzAxXSlgKSlcbiAgICAgIC5leGVjKHN0ZG91dCk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcGFyc2UgYmlvbWV0cmljIGVucm9sbG1lbnQgc3RhdGUgZnJvbSAnJHtzdGRvdXR9J2ApO1xuICAgIH1cbiAgICBsb2cuaW5mbyhgQ3VycmVudCBiaW9tZXRyaWMgZW5yb2xsZWQgc3RhdGUgZm9yICR7dGhpcy51ZGlkfSBTaW11bGF0b3I6ICR7bWF0Y2hbMV19YCk7XG4gICAgcmV0dXJuIG1hdGNoWzFdID09PSAnMSc7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICBhc3luYyBlbnJvbGxCaW9tZXRyaWMgKGlzRW5hYmxlZCA9IHRydWUpIHtcbiAgICBsb2cuZGVidWcoYFNldHRpbmcgYmlvbWV0cmljIGVucm9sbGVkIHN0YXRlIGZvciAke3RoaXMudWRpZH0gU2ltdWxhdG9yIHRvICcke2lzRW5hYmxlZCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCd9J2ApO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbm90aWZ5dXRpbCcsXG4gICAgICAnLXMnLCBFTlJPTExNRU5UX05PVElGSUNBVElPTl9SRUNFSVZFUiwgaXNFbmFibGVkID8gJzEnIDogJzAnXG4gICAgXSk7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdub3RpZnl1dGlsJyxcbiAgICAgICctcCcsIEVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSXG4gICAgXSk7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNCaW9tZXRyaWNFbnJvbGxlZCgpICE9PSBpc0VuYWJsZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHNldCBiaW9tZXRyaWMgZW5yb2xsZWQgc3RhdGUgZm9yICR7dGhpcy51ZGlkfSBTaW11bGF0b3IgdG8gJyR7aXNFbmFibGVkID8gJ2VuYWJsZWQnIDogJ2Rpc2FibGVkJ30nYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgbm90aWZpY2F0aW9uIHRvIG1hdGNoL25vdCBtYXRjaCB0aGUgcGFydGljdWxhciBiaW9tZXRyaWMuXG4gICAqIEBvdmVycmlkZVxuICAgKlxuICAgKiBAcGFyYW0gez9ib29sZWFufSBzaG91bGRNYXRjaCBbdHJ1ZV0gLSBTZXQgaXQgdG8gdHJ1ZSBvciBmYWxzZSBpbiBvcmRlciB0byBlbXVsYXRlXG4gICAqIG1hdGNoaW5nL25vdCBtYXRjaGluZyB0aGUgY29ycmVzcG9uZGluZyBiaW9tZXRyaWNcbiAgICogQHBhcmFtIHs/c3RyaW5nfSBiaW9tZXRyaWNOYW1lIFt0b3VjaElkXSAtIEVpdGhlciB0b3VjaElkIG9yIGZhY2VJZCAoZmFjZUlkIGlzIG9ubHkgYXZhaWxhYmxlIHNpbmNlIGlPUyAxMSlcbiAgICovXG4gIGFzeW5jIHNlbmRCaW9tZXRyaWNNYXRjaCAoc2hvdWxkTWF0Y2ggPSB0cnVlLCBiaW9tZXRyaWNOYW1lID0gJ3RvdWNoSWQnKSB7XG4gICAgY29uc3QgZG9tYWluQ29tcG9uZW50ID0gdG9CaW9tZXRyaWNEb21haW5Db21wb25lbnQoYmlvbWV0cmljTmFtZSk7XG4gICAgY29uc3QgZG9tYWluID0gYGNvbS5hcHBsZS5CaW9tZXRyaWNLaXRfU2ltLiR7ZG9tYWluQ29tcG9uZW50fS4ke3Nob3VsZE1hdGNoID8gJycgOiAnbm8nfW1hdGNoYDtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ25vdGlmeXV0aWwnLFxuICAgICAgJy1wJywgZG9tYWluXG4gICAgXSk7XG4gICAgbG9nLmluZm8oYFNlbnQgbm90aWZpY2F0aW9uICR7ZG9tYWlufSB0byAke3Nob3VsZE1hdGNoID8gJ21hdGNoJyA6ICdub3QgbWF0Y2gnfSAke2Jpb21ldHJpY05hbWV9IGJpb21ldHJpYyBgICtcbiAgICAgIGBmb3IgJHt0aGlzLnVkaWR9IFNpbXVsYXRvcmApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvdmVycmlkZVxuICAgKi9cbiAgYXN5bmMgZ2V0TGF1bmNoRGFlbW9uc1Jvb3QgKCkge1xuICAgIGNvbnN0IGRldlJvb3QgPSBhd2FpdCBnZXREZXZlbG9wZXJSb290KCk7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShkZXZSb290LFxuICAgICAgJ1BsYXRmb3Jtcy9pUGhvbmVPUy5wbGF0Zm9ybS9EZXZlbG9wZXIvTGlicmFyeS9Db3JlU2ltdWxhdG9yL1Byb2ZpbGVzL1J1bnRpbWVzL2lPUy5zaW1ydW50aW1lL0NvbnRlbnRzL1Jlc291cmNlcy9SdW50aW1lUm9vdC9TeXN0ZW0vTGlicmFyeS9MYXVuY2hEYWVtb25zJyk7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gS2V5Ym9hcmRPcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUga2V5Ym9hcmQgbG9jYWxlLCBmb3IgZXhhbXBsZSBgZW5fVVNgIG9yIGBkZV9DSGBcbiAgICogQHByb3BlcnR5IHshc3RyaW5nfSBsYXlvdXQgVGhlIGtleWJvYXJkIGxheW91dCwgZm9yIGV4YW1wbGUgYFFVRVJUWWAgb3IgYFVrcmFpbmlhbmBcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBoYXJkd2FyZSBDb3VsZCBlaXRoZXIgYmUgYEF1dG9tYXRpY2Agb3IgYG51bGxgXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBMYW5ndWFnZU9wdGlvbnNcbiAgICogQHByb3BlcnR5IHshc3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBsYW5ndWFnZSwgZm9yIGV4YW1wbGUgYGRlYCBvciBgemgtSGFudC1DTmBcbiAgICovXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IExvY2FsZU9wdGlvbnNcbiAgICogQHByb3BlcnR5IHshc3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBzeXN0ZW0gbG9jYWxlLCBmb3IgZXhhbXBsZSBgZGVfQ0hgIG9yIGB6aF9DTmBcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBjYWxlbmRhciBPcHRpb25hbCBjYWxlbmRhciBmb3JtYXQsIGZvciBleGFtcGxlIGBncmVnb3JpYW5gIG9yIGBwZXJzaWFuYFxuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gTG9jYWxpemF0aW9uT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgez9LZXlib2FyZE9wdGlvbnN9IGtleWJvYXJkXG4gICAqIEBwcm9wZXJ0eSB7P0xhbmd1YWdlT3B0aW9uc30gbGFuZ3VhZ2VcbiAgICogQHByb3BlcnR5IHs/TG9jYWxlT3B0aW9uc30gbG9jYWxlXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgbG9jYWxpemF0aW9uIHNldHRpbmdzIG9uIHRoZSBjdXJyZW50bHkgYm9vdGVkIHNpbXVsYXRvclxuICAgKlxuICAgKiBAcGFyYW0gez9Mb2NhbGl6YXRpb25PcHRpb25zfSBvcHRzXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIHNldHRpbmcgdGhlIHByZWZlcmVuY2VzXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBgdHJ1ZWAgaWYgYW55IG9mIHNldHRpbmdzIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBjaGFuZ2VkXG4gICAqL1xuICBhc3luYyBjb25maWd1cmVMb2NhbGl6YXRpb24gKG9wdHMgPSB7fSkge1xuICAgIGlmIChfLmlzRW1wdHkob3B0cykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGxhbmd1YWdlLCBsb2NhbGUsIGtleWJvYXJkIH0gPSBvcHRzO1xuICAgIGNvbnN0IGdsb2JhbFByZWZzID0ge307XG4gICAgbGV0IGtleWJvYXJkSWQgPSBudWxsO1xuICAgIGlmIChfLmlzUGxhaW5PYmplY3Qoa2V5Ym9hcmQpKSB7XG4gICAgICBjb25zdCB7IG5hbWUsIGxheW91dCwgaGFyZHdhcmUgfSA9IGtleWJvYXJkO1xuICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICdrZXlib2FyZCcgZmllbGQgbXVzdCBoYXZlIGEgdmFsaWQgbmFtZSBzZXRgKTtcbiAgICAgIH1cbiAgICAgIGlmICghbGF5b3V0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICdrZXlib2FyZCcgZmllbGQgbXVzdCBoYXZlIGEgdmFsaWQgbGF5b3V0IHNldGApO1xuICAgICAgfVxuICAgICAga2V5Ym9hcmRJZCA9IGAke25hbWV9QHN3PSR7bGF5b3V0fWA7XG4gICAgICBpZiAoaGFyZHdhcmUpIHtcbiAgICAgICAga2V5Ym9hcmRJZCArPSBgO0Bodz0ke2hhcmR3YXJlfWA7XG4gICAgICB9XG4gICAgICBnbG9iYWxQcmVmcy5BcHBsZUtleWJvYXJkcyA9IFtrZXlib2FyZElkXTtcbiAgICB9XG4gICAgaWYgKF8uaXNQbGFpbk9iamVjdChsYW5ndWFnZSkpIHtcbiAgICAgIGNvbnN0IHsgbmFtZSB9ID0gbGFuZ3VhZ2U7XG4gICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJ2xhbmd1YWdlJyBmaWVsZCBtdXN0IGhhdmUgYSB2YWxpZCBuYW1lIHNldGApO1xuICAgICAgfVxuICAgICAgZ2xvYmFsUHJlZnMuQXBwbGVMYW5ndWFnZXMgPSBbbmFtZV07XG4gICAgfVxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QobG9jYWxlKSkge1xuICAgICAgY29uc3QgeyBuYW1lLCBjYWxlbmRhciB9ID0gbG9jYWxlO1xuICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICdsb2NhbGUnIGZpZWxkIG11c3QgaGF2ZSBhIHZhbGlkIG5hbWUgc2V0YCk7XG4gICAgICB9XG4gICAgICBsZXQgbG9jYWxlSWQgPSBuYW1lO1xuICAgICAgaWYgKGNhbGVuZGFyKSB7XG4gICAgICAgIGxvY2FsZUlkICs9IGBAY2FsZW5kYXI9JHtjYWxlbmRhcn1gO1xuICAgICAgfVxuICAgICAgZ2xvYmFsUHJlZnMuQXBwbGVMb2NhbGUgPSBsb2NhbGVJZDtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShnbG9iYWxQcmVmcykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBhcmdDaHVua3MgPSBnZW5lcmF0ZURlZmF1bHRzQ29tbWFuZEFyZ3MoZ2xvYmFsUHJlZnMsIHRydWUpO1xuICAgIGF3YWl0IEIuYWxsKGFyZ0NodW5rcy5tYXAoKGFyZ3MpID0+IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnZGVmYXVsdHMnLCAnd3JpdGUnLCAnLkdsb2JhbFByZWZlcmVuY2VzLnBsaXN0JywgLi4uYXJnc1xuICAgIF0pKSk7XG5cbiAgICBpZiAoa2V5Ym9hcmRJZCkge1xuICAgICAgY29uc3QgYXJnQ2h1bmtzID0gZ2VuZXJhdGVEZWZhdWx0c0NvbW1hbmRBcmdzKHtcbiAgICAgICAgS2V5Ym9hcmRzQ3VycmVudEFuZE5leHQ6IFtrZXlib2FyZElkXSxcbiAgICAgICAgS2V5Ym9hcmRMYXN0VXNlZDoga2V5Ym9hcmRJZCxcbiAgICAgICAgS2V5Ym9hcmRMYXN0VXNlZEZvckxhbmd1YWdlOiB7IFtrZXlib2FyZC5uYW1lXToga2V5Ym9hcmRJZCB9XG4gICAgICB9LCB0cnVlKTtcbiAgICAgIGF3YWl0IEIuYWxsKGFyZ0NodW5rcy5tYXAoKGFyZ3MpID0+IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAgICdkZWZhdWx0cycsICd3cml0ZScsICdjb20uYXBwbGUuUHJlZmVyZW5jZXMnLCAuLi5hcmdzXG4gICAgICBdKSkpO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlOTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxlQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxVQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSyxPQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTSxTQUFBLEdBQUFOLE9BQUE7QUFDQSxJQUFBTyxNQUFBLEdBQUFQLE9BQUE7QUFHQSxJQUFBUSxjQUFBLEdBQUFSLE9BQUE7QUFDQSxJQUFBUyxTQUFBLEdBQUFWLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVSxPQUFBLEdBQUFWLE9BQUE7QUFDQSxJQUFBVyxZQUFBLEdBQUFYLE9BQUE7QUFDQSxJQUFBWSxhQUFBLEdBQUFaLE9BQUE7QUFFQSxNQUFNYSwwQkFBMEIs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