"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSimulator = getSimulator;
require("source-map-support/register");
var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-8"));
var _simulatorXcode2 = _interopRequireDefault(require("./simulator-xcode-9"));
var _simulatorXcode3 = _interopRequireDefault(require("./simulator-xcode-9.3"));
var _simulatorXcode4 = _interopRequireDefault(require("./simulator-xcode-10"));
var _simulatorXcode5 = _interopRequireDefault(require("./simulator-xcode-11"));
var _simulatorXcode6 = _interopRequireDefault(require("./simulator-xcode-11.4"));
var _simulatorXcode7 = _interopRequireDefault(require("./simulator-xcode-14"));
var _simulatorXcode8 = _interopRequireDefault(require("./simulator-xcode-15"));
var _utils = require("./utils");
var _appiumXcode = _interopRequireDefault(require("appium-xcode"));
var _logger = require("./logger");
const MIN_SUPPORTED_XCODE_VERSION = 8;
function handleUnsupportedXcode(xcodeVersion) {
  if (xcodeVersion.major < MIN_SUPPORTED_XCODE_VERSION) {
    throw new Error(`Tried to use an iOS simulator with xcode version ${xcodeVersion.versionString} but only Xcode version ` + `${MIN_SUPPORTED_XCODE_VERSION} and up are supported`);
  }
  return xcodeVersion;
}
async function getSimulator(udid, opts = {}) {
  let {
    platform = 'iOS',
    checkExistence = true,
    devicesSetPath
  } = opts;
  const xcodeVersion = handleUnsupportedXcode(await _appiumXcode.default.getVersion(true));
  if (checkExistence) {
    const simulatorInfo = await (0, _utils.getSimulatorInfo)(udid, {
      devicesSetPath
    });
    if (!simulatorInfo) {
      throw new Error(`No sim found with udid '${udid}'`);
    }
    platform = simulatorInfo.platform;
  }
  (0, _logger.setLoggingPlatform)(platform);
  _logger.log.info(`Constructing ${platform} simulator for Xcode version ${xcodeVersion.versionString} with udid '${udid}'`);
  let SimClass;
  switch (xcodeVersion.major) {
    case 8:
      SimClass = _simulatorXcode.default;
      break;
    case 9:
      SimClass = xcodeVersion.minor < 3 ? _simulatorXcode2.default : _simulatorXcode3.default;
      break;
    case 10:
      SimClass = _simulatorXcode4.default;
      break;
    case 11:
      SimClass = xcodeVersion.minor < 4 ? _simulatorXcode5.default : _simulatorXcode6.default;
      break;
    case 12:
    case 13:
      SimClass = _simulatorXcode6.default;
      break;
    case 14:
      SimClass = _simulatorXcode7.default;
      break;
    case 15:
    default:
      SimClass = _simulatorXcode8.default;
      break;
  }
  const result = new SimClass(udid, xcodeVersion);
  if (devicesSetPath) {
    result.devicesSetPath = devicesSetPath;
  }
  return result;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2ltdWxhdG9yWGNvZGUiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zaW11bGF0b3JYY29kZTIiLCJfc2ltdWxhdG9yWGNvZGUzIiwiX3NpbXVsYXRvclhjb2RlNCIsIl9zaW11bGF0b3JYY29kZTUiLCJfc2ltdWxhdG9yWGNvZGU2IiwiX3NpbXVsYXRvclhjb2RlNyIsIl9zaW11bGF0b3JYY29kZTgiLCJfdXRpbHMiLCJfYXBwaXVtWGNvZGUiLCJfbG9nZ2VyIiwiTUlOX1NVUFBPUlRFRF9YQ09ERV9WRVJTSU9OIiwiaGFuZGxlVW5zdXBwb3J0ZWRYY29kZSIsInhjb2RlVmVyc2lvbiIsIm1ham9yIiwiRXJyb3IiLCJ2ZXJzaW9uU3RyaW5nIiwiZ2V0U2ltdWxhdG9yIiwidWRpZCIsIm9wdHMiLCJwbGF0Zm9ybSIsImNoZWNrRXhpc3RlbmNlIiwiZGV2aWNlc1NldFBhdGgiLCJ4Y29kZSIsImdldFZlcnNpb24iLCJzaW11bGF0b3JJbmZvIiwiZ2V0U2ltdWxhdG9ySW5mbyIsInNldExvZ2dpbmdQbGF0Zm9ybSIsImxvZyIsImluZm8iLCJTaW1DbGFzcyIsIlNpbXVsYXRvclhjb2RlOCIsIm1pbm9yIiwiU2ltdWxhdG9yWGNvZGU5IiwiU2ltdWxhdG9yWGNvZGU5MyIsIlNpbXVsYXRvclhjb2RlMTAiLCJTaW11bGF0b3JYY29kZTExIiwiU2ltdWxhdG9yWGNvZGUxMV80IiwiU2ltdWxhdG9yWGNvZGUxNCIsIlNpbXVsYXRvclhjb2RlMTUiLCJyZXN1bHQiXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2ltdWxhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTaW11bGF0b3JYY29kZTggZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtOCc7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGU5IGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTknO1xuaW1wb3J0IFNpbXVsYXRvclhjb2RlOTMgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtOS4zJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTEwIGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTEwJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTExIGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTExJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTExXzQgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtMTEuNCc7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGUxNCBmcm9tICcuL3NpbXVsYXRvci14Y29kZS0xNCc7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGUxNSBmcm9tICcuL3NpbXVsYXRvci14Y29kZS0xNSc7XG5pbXBvcnQgeyBnZXRTaW11bGF0b3JJbmZvIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCB7IGxvZywgc2V0TG9nZ2luZ1BsYXRmb3JtIH0gZnJvbSAnLi9sb2dnZXInO1xuXG5jb25zdCBNSU5fU1VQUE9SVEVEX1hDT0RFX1ZFUlNJT04gPSA4O1xuXG5mdW5jdGlvbiBoYW5kbGVVbnN1cHBvcnRlZFhjb2RlICh4Y29kZVZlcnNpb24pIHtcbiAgaWYgKHhjb2RlVmVyc2lvbi5tYWpvciA8IE1JTl9TVVBQT1JURURfWENPREVfVkVSU0lPTikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBUcmllZCB0byB1c2UgYW4gaU9TIHNpbXVsYXRvciB3aXRoIHhjb2RlIHZlcnNpb24gJHt4Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ30gYnV0IG9ubHkgWGNvZGUgdmVyc2lvbiBgICtcbiAgICAgIGAke01JTl9TVVBQT1JURURfWENPREVfVkVSU0lPTn0gYW5kIHVwIGFyZSBzdXBwb3J0ZWRgXG4gICAgKTtcbiAgfVxuICByZXR1cm4geGNvZGVWZXJzaW9uO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFNpbXVsYXRvckxvb2t1cE9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcGxhdGZvcm0gW2lPU10gLSBUaGUgbmFtZSBvZiB0aGUgc2ltdWxhdG9yIHBsYXRmb3JtXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBjaGVja0V4aXN0ZW5jZSBbdHJ1ZV0gLSBTZXQgaXQgdG8gYGZhbHNlYCBpbiBvcmRlciB0b1xuICogc2tpcCBzaW11bGF0b3IgZXhpc3RlbmNlIHZlcmlmaWNhdGlvblxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBkZXZpY2VzU2V0UGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0IHdoZXJlXG4gKiB0aGUgY3VycmVudCBzaW11bGF0b3IgaXMgbG9jYXRlZC4gYG51bGxgIHZhbHVlIG1lYW5zIHRoYXQgdGhlIGRlZmF1bHQgcGF0aCBpc1xuICogdXNlZCwgd2hpY2ggaXMgdXN1YWxseSBgfi9MaWJyYXJ5L0RldmVsb3Blci9Db3JlU2ltdWxhdG9yL0RldmljZXNgXG4gKi9cblxuLyoqXG4gKiBGaW5kcyBhbmQgcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyBTaW11bGF0b3IgaW5zdGFuY2UgZm9yIHRoZSBnaXZlbiBJRC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0gez9TaW11bGF0b3JMb29rdXBPcHRpb25zfSBvcHRzXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIFNpbXVsYXRvciB3aXRoIGdpdmVuIHVkaWQgZG9lcyBub3QgZXhpc3QgaW4gZGV2aWNlcyBsaXN0LlxuICogICBJZiB5b3Ugd2FudCB0byBjcmVhdGUgYSBuZXcgc2ltdWxhdG9yLCB5b3UgY2FuIHVzZSB0aGUgYGNyZWF0ZURldmljZSgpYCBtZXRob2Qgb2ZcbiAqICAgW25vZGUtc2ltY3RsXShnaXRodWIuY29tL2FwcGl1bS9ub2RlLXNpbWN0bCkuXG4gKiBAcmV0dXJuIHtvYmplY3R9IFNpbXVsYXRvciBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSB1ZGlkIHBhc3NlZCBpbi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0U2ltdWxhdG9yICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgbGV0IHtcbiAgICBwbGF0Zm9ybSA9ICdpT1MnLFxuICAgIGNoZWNrRXhpc3RlbmNlID0gdHJ1ZSxcbiAgICBkZXZpY2VzU2V0UGF0aCxcbiAgfSA9IG9wdHM7XG5cbiAgY29uc3QgeGNvZGVWZXJzaW9uID0gaGFuZGxlVW5zdXBwb3J0ZWRYY29kZShhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpKTtcbiAgaWYgKGNoZWNrRXhpc3RlbmNlKSB7XG4gICAgY29uc3Qgc2ltdWxhdG9ySW5mbyA9IGF3YWl0IGdldFNpbXVsYXRvckluZm8odWRpZCwge1xuICAgICAgZGV2aWNlc1NldFBhdGhcbiAgICB9KTtcblxuICAgIGlmICghc2ltdWxhdG9ySW5mbykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBzaW0gZm91bmQgd2l0aCB1ZGlkICcke3VkaWR9J2ApO1xuICAgIH1cblxuICAgIHBsYXRmb3JtID0gc2ltdWxhdG9ySW5mby5wbGF0Zm9ybTtcbiAgfVxuXG4gIC8vIG1ha2Ugc3VyZSB3ZSBoYXZlIHRoZSByaWdodCBsb2dnaW5nIHByZWZpeFxuICBzZXRMb2dnaW5nUGxhdGZvcm0ocGxhdGZvcm0pO1xuXG4gIGxvZy5pbmZvKFxuICAgIGBDb25zdHJ1Y3RpbmcgJHtwbGF0Zm9ybX0gc2ltdWxhdG9yIGZvciBYY29kZSB2ZXJzaW9uICR7eGNvZGVWZXJzaW9uLnZlcnNpb25TdHJpbmd9IHdpdGggdWRpZCAnJHt1ZGlkfSdgXG4gICk7XG4gIGxldCBTaW1DbGFzcztcbiAgc3dpdGNoICh4Y29kZVZlcnNpb24ubWFqb3IpIHtcbiAgICBjYXNlIDg6XG4gICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlODtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgOTpcbiAgICAgIFNpbUNsYXNzID0geGNvZGVWZXJzaW9uLm1pbm9yIDwgMyA/IFNpbXVsYXRvclhjb2RlOSA6IFNpbXVsYXRvclhjb2RlOTM7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDEwOlxuICAgICAgU2ltQ2xhc3MgPSBTaW11bGF0b3JYY29kZTEwO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAxMTpcbiAgICAgIFNpbUNsYXNzID0geGNvZGVWZXJzaW9uLm1pbm9yIDwgNCA/IFNpbXVsYXRvclhjb2RlMTEgOiBTaW11bGF0b3JYY29kZTExXzQ7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDEyOlxuICAgIGNhc2UgMTM6XG4gICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlMTFfNDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMTQ6XG4gICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlMTQ7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDE1OlxuICAgIGRlZmF1bHQ6XG4gICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlMTU7XG4gICAgICBicmVhaztcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBTaW1DbGFzcyh1ZGlkLCB4Y29kZVZlcnNpb24pO1xuICBpZiAoZGV2aWNlc1NldFBhdGgpIHtcbiAgICByZXN1bHQuZGV2aWNlc1NldFBhdGggPSBkZXZpY2VzU2V0UGF0aDtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgeyBnZXRTaW11bGF0b3IgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxlQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxnQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsZ0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLGdCQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSSxnQkFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssZ0JBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLGdCQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTyxnQkFBQSxHQUFBUixz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