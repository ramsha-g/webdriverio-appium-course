{"version":3,"file":"simulator-xcode-15.js","names":["_support","require","_teen_process","_path","_interopRequireDefault","_lodash","_bluebird","_simulatorXcode","SimulatorXcode15","SimulatorXcode14","_fetchSystemAppBundleIds","_systemAppBundleIds","appsRoot","path","resolve","simctl","getEnv","fetchBundleId","appRoot","stdout","exec","_","trim","allApps","fs","readdir","filter","x","endsWith","map","join","Set","B","all","isAppInstalled","bundleId","appContainer","getAppContainer","exists","err","has","getLaunchDaemonsRoot","_default","exports","default"],"sources":["../../lib/simulator-xcode-15.js"],"sourcesContent":["import { fs } from '@appium/support';\nimport { exec } from 'teen_process';\nimport path from 'path';\nimport _ from 'lodash';\nimport B from 'bluebird';\nimport SimulatorXcode14 from './simulator-xcode-14';\n\nclass SimulatorXcode15 extends SimulatorXcode14 {\n  /**\n   * Collects and caches bundle indetifier of system Simulator apps\n   *\n   * @returns {Promise<Set<string>>}\n   */\n  async _fetchSystemAppBundleIds () {\n    if (this._systemAppBundleIds) {\n      return this._systemAppBundleIds;\n    }\n\n    const appsRoot = path.resolve(await this.simctl.getEnv('IPHONE_SIMULATOR_ROOT'), 'Applications');\n    const fetchBundleId = async (appRoot) => {\n      const {stdout} = await exec('/usr/libexec/PlistBuddy', [\n        '-c', 'print CFBundleIdentifier', path.resolve(appRoot, 'Info.plist')\n      ]);\n      return _.trim(stdout);\n    };\n    const allApps = (await fs.readdir(appsRoot))\n      .filter((x) => x.endsWith('.app'))\n      .map((x) => path.join(appsRoot, x));\n    this._systemAppBundleIds = new Set(await B.all(allApps.map(fetchBundleId)));\n    return this._systemAppBundleIds;\n  }\n\n  /**\n   * Verify whether the particular application is installed on Simulator.\n   * @override\n   *\n   * @param {string} bundleId - The bundle id of the application to be checked.\n   * @return {Promise<boolean>} True if the given application is installed.\n   */\n  async isAppInstalled (bundleId) {\n    try {\n      const appContainer = await this.simctl.getAppContainer(bundleId);\n      if (!appContainer.endsWith('.app')) {\n        return false;\n      }\n      return await fs.exists(appContainer);\n    } catch (err) {\n      // get_app_container subcommand fails for system applications,\n      // as well as the hidden appinfo command\n      return (await this._fetchSystemAppBundleIds()).has(bundleId);\n    }\n  }\n\n  /**\n   * @override\n   * @inheritdoc\n   */\n  async getLaunchDaemonsRoot () {\n    return path.resolve(\n      await this.simctl.getEnv('IPHONE_SIMULATOR_ROOT'),\n      'System/Library/LaunchDaemons'\n    );\n  }\n}\n\nexport default SimulatorXcode15;\n"],"mappings":";;;;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,KAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,OAAA,GAAAD,sBAAA,CAAAH,OAAA;AACA,IAAAK,SAAA,GAAAF,sBAAA,CAAAH,OAAA;AACA,IAAAM,eAAA,GAAAH,sBAAA,CAAAH,OAAA;AAEA,MAAMO,gBAAgB,SAASC,uBAAgB,CAAC;EAM9C,MAAMC,wBAAwBA,CAAA,EAAI;IAChC,IAAI,IAAI,CAACC,mBAAmB,EAAE;MAC5B,OAAO,IAAI,CAACA,mBAAmB;IACjC;IAEA,MAAMC,QAAQ,GAAGC,aAAI,CAACC,OAAO,CAAC,MAAM,IAAI,CAACC,MAAM,CAACC,MAAM,CAAC,uBAAuB,CAAC,EAAE,cAAc,CAAC;IAChG,MAAMC,aAAa,GAAG,MAAOC,OAAO,IAAK;MACvC,MAAM;QAACC;MAAM,CAAC,GAAG,MAAM,IAAAC,kBAAI,EAAC,yBAAyB,EAAE,CACrD,IAAI,EAAE,0BAA0B,EAAEP,aAAI,CAACC,OAAO,CAACI,OAAO,EAAE,YAAY,CAAC,CACtE,CAAC;MACF,OAAOG,eAAC,CAACC,IAAI,CAACH,MAAM,CAAC;IACvB,CAAC;IACD,MAAMI,OAAO,GAAG,CAAC,MAAMC,WAAE,CAACC,OAAO,CAACb,QAAQ,CAAC,EACxCc,MAAM,CAAEC,CAAC,IAAKA,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC,CAAC,CACjCC,GAAG,CAAEF,CAAC,IAAKd,aAAI,CAACiB,IAAI,CAAClB,QAAQ,EAAEe,CAAC,CAAC,CAAC;IACrC,IAAI,CAAChB,mBAAmB,GAAG,IAAIoB,GAAG,CAAC,MAAMC,iBAAC,CAACC,GAAG,CAACV,OAAO,CAACM,GAAG,CAACZ,aAAa,CAAC,CAAC,CAAC;IAC3E,OAAO,IAAI,CAACN,mBAAmB;EACjC;EASA,MAAMuB,cAAcA,CAAEC,QAAQ,EAAE;IAC9B,IAAI;MACF,MAAMC,YAAY,GAAG,MAAM,IAAI,CAACrB,MAAM,CAACsB,eAAe,CAACF,QAAQ,CAAC;MAChE,IAAI,CAACC,YAAY,CAACR,QAAQ,CAAC,MAAM,CAAC,EAAE;QAClC,OAAO,KAAK;MACd;MACA,OAAO,MAAMJ,WAAE,CAACc,MAAM,CAACF,YAAY,CAAC;IACtC,CAAC,CAAC,OAAOG,GAAG,EAAE;MAGZ,OAAO,CAAC,MAAM,IAAI,CAAC7B,wBAAwB,CAAC,CAAC,EAAE8B,GAAG,CAACL,QAAQ,CAAC;IAC9D;EACF;EAMA,MAAMM,oBAAoBA,CAAA,EAAI;IAC5B,OAAO5B,aAAI,CAACC,OAAO,CACjB,MAAM,IAAI,CAACC,MAAM,CAACC,MAAM,CAAC,uBAAuB,CAAC,EACjD,8BACF,CAAC;EACH;AACF;AAAC,IAAA0B,QAAA,GAEclC,gBAAgB;AAAAmC,OAAA,CAAAC,OAAA,GAAAF,QAAA"}