"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SIMULATOR_APP_NAME = exports.SAFARI_STARTUP_TIMEOUT_MS = exports.MOBILE_SAFARI_BUNDLE_ID = void 0;
exports.activateApp = activateApp;
exports.getDeveloperRoot = getDeveloperRoot;
exports.getSimulatorInfo = getSimulatorInfo;
exports.killAllSimulators = killAllSimulators;
exports.simExists = simExists;
exports.toBiometricDomainComponent = toBiometricDomainComponent;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("./logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _teen_process = require("teen_process");
var _asyncbox = require("asyncbox");
var _appiumXcode = require("appium-xcode");
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
var _path = _interopRequireDefault(require("path"));
const DEFAULT_SIM_SHUTDOWN_TIMEOUT_MS = 30000;
const SAFARI_STARTUP_TIMEOUT_MS = 25 * 1000;
exports.SAFARI_STARTUP_TIMEOUT_MS = SAFARI_STARTUP_TIMEOUT_MS;
const MOBILE_SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
exports.MOBILE_SAFARI_BUNDLE_ID = MOBILE_SAFARI_BUNDLE_ID;
const SIMULATOR_APP_NAME = 'Simulator.app';
exports.SIMULATOR_APP_NAME = SIMULATOR_APP_NAME;
const APP_ACTIVATION_SCRIPT = pid => `
use framework "Foundation"
use framework "AppKit"
use scripting additions

set theApp to current application's NSRunningApplication's runningApplicationWithProcessIdentifier:${pid}
if theApp = null then
	log "Cannot find Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
set result to theApp's activateWithOptions:3
if not result then
	log "Cannot activate Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
`;
const BIOMETRICS = {
  touchId: 'fingerTouch',
  faceId: 'pearl'
};
function toBiometricDomainComponent(name) {
  if (!BIOMETRICS[name]) {
    throw new Error(`'${name}' is not a valid biometric. Use one of: ${JSON.stringify(_lodash.default.keys(BIOMETRICS))}`);
  }
  return BIOMETRICS[name];
}
async function pkill(appName, forceKill = false) {
  let args = forceKill ? ['-9'] : [];
  args.push('-x', appName);
  try {
    await (0, _teen_process.exec)('pkill', args);
    return 0;
  } catch (err) {
    if (!_lodash.default.isUndefined(err.code)) {
      throw new Error(`Cannot forcefully terminate ${appName}. pkill error code: ${err.code}`);
    }
    _logger.default.error(`Received unexpected error while trying to kill ${appName}: ${err.message}`);
    throw err;
  }
}
async function killAllSimulators(timeout = DEFAULT_SIM_SHUTDOWN_TIMEOUT_MS) {
  _logger.default.debug('Killing all iOS Simulators');
  const xcodeVersion = await (0, _appiumXcode.getVersion)(true);
  const appName = _path.default.parse(SIMULATOR_APP_NAME).name;
  timeout = timeout * (xcodeVersion.major >= 8 ? 2 : 1);
  try {
    await (0, _teen_process.exec)('xcrun', ['simctl', 'shutdown', xcodeVersion.major > 8 ? 'all' : 'booted'], {
      timeout
    });
  } catch (ign) {}
  const pids = [];
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('pgrep', ['-f', `${appName}.app/Contents/MacOS/`]);
    if (stdout.trim()) {
      pids.push(...stdout.trim().split(/\s+/));
    }
  } catch (e) {
    if (e.code === 1) {
      _logger.default.debug(`${appName} is not running. Continuing...`);
      return;
    }
    if (_lodash.default.isEmpty(pids)) {
      _logger.default.warn(`pgrep error ${e.code} while detecting whether ${appName} is running. Trying to kill anyway.`);
    }
  }
  if (!_lodash.default.isEmpty(pids)) {
    _logger.default.debug(`Killing processes: ${pids.join(', ')}`);
    try {
      await (0, _teen_process.exec)('kill', ['-9', ...pids.map(pid => `${pid}`)]);
    } catch (ign) {}
  }
  _logger.default.debug(`Using pkill to kill application: ${appName}`);
  try {
    await pkill(appName, true);
  } catch (ign) {}
  let remainingDevices = [];
  async function allSimsAreDown() {
    remainingDevices = [];
    let devices = await new _nodeSimctl.default().getDevices();
    devices = _lodash.default.flatten(_lodash.default.values(devices));
    return _lodash.default.every(devices, sim => {
      const state = sim.state.toLowerCase();
      const done = ['shutdown', 'unavailable', 'disconnected'].includes(state);
      if (!done) {
        remainingDevices.push(`${sim.name} (${sim.sdk}, udid: ${sim.udid}) is still in state '${state}'`);
      }
      return done;
    });
  }
  try {
    await (0, _asyncbox.waitForCondition)(allSimsAreDown, {
      waitMs: timeout,
      intervalMs: 200
    });
  } catch (err) {
    if (remainingDevices.length > 0) {
      _logger.default.warn(`The following devices are still not in the correct state after ${timeout} ms:`);
      for (let device of remainingDevices) {
        _logger.default.warn(`    ${device}`);
      }
    }
    throw err;
  }
}
async function getSimulatorInfo(udid, opts = {}) {
  const {
    devicesSetPath
  } = opts;
  let devices = await new _nodeSimctl.default({
    devicesSetPath
  }).getDevices();
  devices = _lodash.default.toPairs(devices).map(pair => pair[1]).reduce((a, b) => a.concat(b), []);
  return _lodash.default.find(devices, sim => sim.udid === udid);
}
async function simExists(udid) {
  return !!(await getSimulatorInfo(udid));
}
async function getDeveloperRoot() {
  const {
    stdout
  } = await (0, _teen_process.exec)('xcode-select', ['-p']);
  return stdout.trim();
}
async function activateApp(pid) {
  try {
    await (0, _teen_process.exec)('osascript', ['-e', APP_ACTIVATION_SCRIPT(pid)]);
  } catch (e) {
    throw new Error(`Simulator window cannot be activated. Original error: ${e.stderr || e.message}`);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9nZ2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX3RlZW5fcHJvY2VzcyIsIl9hc3luY2JveCIsIl9hcHBpdW1YY29kZSIsIl9ub2RlU2ltY3RsIiwiX3BhdGgiLCJERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUX01TIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVF9NUyIsImV4cG9ydHMiLCJNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCIsIlNJTVVMQVRPUl9BUFBfTkFNRSIsIkFQUF9BQ1RJVkFUSU9OX1NDUklQVCIsInBpZCIsIkJJT01FVFJJQ1MiLCJ0b3VjaElkIiwiZmFjZUlkIiwidG9CaW9tZXRyaWNEb21haW5Db21wb25lbnQiLCJuYW1lIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiXyIsImtleXMiLCJwa2lsbCIsImFwcE5hbWUiLCJmb3JjZUtpbGwiLCJhcmdzIiwicHVzaCIsImV4ZWMiLCJlcnIiLCJpc1VuZGVmaW5lZCIsImNvZGUiLCJsb2ciLCJlcnJvciIsIm1lc3NhZ2UiLCJraWxsQWxsU2ltdWxhdG9ycyIsInRpbWVvdXQiLCJkZWJ1ZyIsInhjb2RlVmVyc2lvbiIsImdldFZlcnNpb24iLCJwYXRoIiwicGFyc2UiLCJtYWpvciIsImlnbiIsInBpZHMiLCJzdGRvdXQiLCJ0cmltIiwic3BsaXQiLCJlIiwiaXNFbXB0eSIsIndhcm4iLCJqb2luIiwibWFwIiwicmVtYWluaW5nRGV2aWNlcyIsImFsbFNpbXNBcmVEb3duIiwiZGV2aWNlcyIsIlNpbWN0bCIsImdldERldmljZXMiLCJmbGF0dGVuIiwidmFsdWVzIiwiZXZlcnkiLCJzaW0iLCJzdGF0ZSIsInRvTG93ZXJDYXNlIiwiZG9uZSIsImluY2x1ZGVzIiwic2RrIiwidWRpZCIsIndhaXRGb3JDb25kaXRpb24iLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwibGVuZ3RoIiwiZGV2aWNlIiwiZ2V0U2ltdWxhdG9ySW5mbyIsIm9wdHMiLCJkZXZpY2VzU2V0UGF0aCIsInRvUGFpcnMiLCJwYWlyIiwicmVkdWNlIiwiYSIsImIiLCJjb25jYXQiLCJmaW5kIiwic2ltRXhpc3RzIiwiZ2V0RGV2ZWxvcGVyUm9vdCIsImFjdGl2YXRlQXBwIiwic3RkZXJyIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL3V0aWxzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IGdldFZlcnNpb24gfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IFNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuXG5jb25zdCBERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUX01TID0gMzAwMDA7XG5jb25zdCBTQUZBUklfU1RBUlRVUF9USU1FT1VUX01TID0gMjUgKiAxMDAwO1xuY29uc3QgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaSc7XG5jb25zdCBTSU1VTEFUT1JfQVBQX05BTUUgPSAnU2ltdWxhdG9yLmFwcCc7XG5jb25zdCBBUFBfQUNUSVZBVElPTl9TQ1JJUFQgPSAocGlkKSA9PiBgXG51c2UgZnJhbWV3b3JrIFwiRm91bmRhdGlvblwiXG51c2UgZnJhbWV3b3JrIFwiQXBwS2l0XCJcbnVzZSBzY3JpcHRpbmcgYWRkaXRpb25zXG5cbnNldCB0aGVBcHAgdG8gY3VycmVudCBhcHBsaWNhdGlvbidzIE5TUnVubmluZ0FwcGxpY2F0aW9uJ3MgcnVubmluZ0FwcGxpY2F0aW9uV2l0aFByb2Nlc3NJZGVudGlmaWVyOiR7cGlkfVxuaWYgdGhlQXBwID0gbnVsbCB0aGVuXG5cdGxvZyBcIkNhbm5vdCBmaW5kIFNpbXVsYXRvciB3aW5kb3cgdW5kZXIgUElEICR7cGlkfS4gSXMgaXQgcnVubmluZz9cIlxuXHRlcnJvciBudW1iZXIgMVxuZW5kIGlmXG5zZXQgcmVzdWx0IHRvIHRoZUFwcCdzIGFjdGl2YXRlV2l0aE9wdGlvbnM6M1xuaWYgbm90IHJlc3VsdCB0aGVuXG5cdGxvZyBcIkNhbm5vdCBhY3RpdmF0ZSBTaW11bGF0b3Igd2luZG93IHVuZGVyIFBJRCAke3BpZH0uIElzIGl0IHJ1bm5pbmc/XCJcblx0ZXJyb3IgbnVtYmVyIDFcbmVuZCBpZlxuYDtcblxuXG5jb25zdCBCSU9NRVRSSUNTID0ge1xuICB0b3VjaElkOiAnZmluZ2VyVG91Y2gnLFxuICBmYWNlSWQ6ICdwZWFybCcsXG59O1xuXG5mdW5jdGlvbiB0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudCAobmFtZSkge1xuICBpZiAoIUJJT01FVFJJQ1NbbmFtZV0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCcke25hbWV9JyBpcyBub3QgYSB2YWxpZCBiaW9tZXRyaWMuIFVzZSBvbmUgb2Y6ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKEJJT01FVFJJQ1MpKX1gKTtcbiAgfVxuICByZXR1cm4gQklPTUVUUklDU1tuYW1lXTtcbn1cblxuLy8gcGdyZXAvcGtpbGwgZXhpdCBjb2Rlczpcbi8vIDAgICAgICAgT25lIG9yIG1vcmUgcHJvY2Vzc2VzIHdlcmUgbWF0Y2hlZC5cbi8vIDEgICAgICAgTm8gcHJvY2Vzc2VzIHdlcmUgbWF0Y2hlZC5cbi8vIDIgICAgICAgSW52YWxpZCBvcHRpb25zIHdlcmUgc3BlY2lmaWVkIG9uIHRoZSBjb21tYW5kIGxpbmUuXG4vLyAzICAgICAgIEFuIGludGVybmFsIGVycm9yIG9jY3VycmVkLlxuYXN5bmMgZnVuY3Rpb24gcGtpbGwgKGFwcE5hbWUsIGZvcmNlS2lsbCA9IGZhbHNlKSB7XG4gIGxldCBhcmdzID0gZm9yY2VLaWxsID8gWyctOSddIDogW107XG4gIGFyZ3MucHVzaCgnLXgnLCBhcHBOYW1lKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKCdwa2lsbCcsIGFyZ3MpO1xuICAgIHJldHVybiAwO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoIV8uaXNVbmRlZmluZWQoZXJyLmNvZGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmb3JjZWZ1bGx5IHRlcm1pbmF0ZSAke2FwcE5hbWV9LiBwa2lsbCBlcnJvciBjb2RlOiAke2Vyci5jb2RlfWApO1xuICAgIH1cbiAgICBsb2cuZXJyb3IoYFJlY2VpdmVkIHVuZXhwZWN0ZWQgZXJyb3Igd2hpbGUgdHJ5aW5nIHRvIGtpbGwgJHthcHBOYW1lfTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24ga2lsbEFsbFNpbXVsYXRvcnMgKHRpbWVvdXQgPSBERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUX01TKSB7XG4gIGxvZy5kZWJ1ZygnS2lsbGluZyBhbGwgaU9TIFNpbXVsYXRvcnMnKTtcbiAgY29uc3QgeGNvZGVWZXJzaW9uID0gYXdhaXQgZ2V0VmVyc2lvbih0cnVlKTtcbiAgY29uc3QgYXBwTmFtZSA9IHBhdGgucGFyc2UoU0lNVUxBVE9SX0FQUF9OQU1FKS5uYW1lO1xuXG4gIC8vIGxhdGVyIHZlcnNpb25zIGFyZSBzbG93ZXIgdG8gY2xvc2VcbiAgdGltZW91dCA9IHRpbWVvdXQgKiAoeGNvZGVWZXJzaW9uLm1ham9yID49IDggPyAyIDogMSk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKCd4Y3J1bicsIFsnc2ltY3RsJywgJ3NodXRkb3duJywgeGNvZGVWZXJzaW9uLm1ham9yID4gOCA/ICdhbGwnIDogJ2Jvb3RlZCddLCB7dGltZW91dH0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgY29uc3QgcGlkcyA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncGdyZXAnLCBbJy1mJywgYCR7YXBwTmFtZX0uYXBwL0NvbnRlbnRzL01hY09TL2BdKTtcbiAgICBpZiAoc3Rkb3V0LnRyaW0oKSkge1xuICAgICAgcGlkcy5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLykpKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5jb2RlID09PSAxKSB7XG4gICAgICBsb2cuZGVidWcoYCR7YXBwTmFtZX0gaXMgbm90IHJ1bm5pbmcuIENvbnRpbnVpbmcuLi5gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShwaWRzKSkge1xuICAgICAgbG9nLndhcm4oYHBncmVwIGVycm9yICR7ZS5jb2RlfSB3aGlsZSBkZXRlY3Rpbmcgd2hldGhlciAke2FwcE5hbWV9IGlzIHJ1bm5pbmcuIFRyeWluZyB0byBraWxsIGFueXdheS5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFfLmlzRW1wdHkocGlkcykpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgcHJvY2Vzc2VzOiAke3BpZHMuam9pbignLCAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygna2lsbCcsIFsnLTknLCAuLi4ocGlkcy5tYXAoKHBpZCkgPT4gYCR7cGlkfWApKV0pO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgVXNpbmcgcGtpbGwgdG8ga2lsbCBhcHBsaWNhdGlvbjogJHthcHBOYW1lfWApO1xuICB0cnkge1xuICAgIGF3YWl0IHBraWxsKGFwcE5hbWUsIHRydWUpO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgLy8gd2FpdCBmb3IgYWxsIHRoZSBkZXZpY2VzIHRvIGJlIHNodXRkb3duIGJlZm9yZSBDb250aW51aW5nXG4gIC8vIGJ1dCBvbmx5IHByaW50IG91dCB0aGUgZmFpbGVkIG9uZXMgd2hlbiB0aGV5IGFyZSBhY3R1YWxseSBmdWxseSBmYWlsZWRcbiAgbGV0IHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgYXN5bmMgZnVuY3Rpb24gYWxsU2ltc0FyZURvd24gKCkge1xuICAgIHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoKS5nZXREZXZpY2VzKCk7XG4gICAgZGV2aWNlcyA9IF8uZmxhdHRlbihfLnZhbHVlcyhkZXZpY2VzKSk7XG4gICAgcmV0dXJuIF8uZXZlcnkoZGV2aWNlcywgKHNpbSkgPT4ge1xuICAgICAgY29uc3Qgc3RhdGUgPSBzaW0uc3RhdGUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IGRvbmUgPSBbJ3NodXRkb3duJywgJ3VuYXZhaWxhYmxlJywgJ2Rpc2Nvbm5lY3RlZCddLmluY2x1ZGVzKHN0YXRlKTtcbiAgICAgIGlmICghZG9uZSkge1xuICAgICAgICByZW1haW5pbmdEZXZpY2VzLnB1c2goYCR7c2ltLm5hbWV9ICgke3NpbS5zZGt9LCB1ZGlkOiAke3NpbS51ZGlkfSkgaXMgc3RpbGwgaW4gc3RhdGUgJyR7c3RhdGV9J2ApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRvbmU7XG4gICAgfSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFsbFNpbXNBcmVEb3duLCB7XG4gICAgICB3YWl0TXM6IHRpbWVvdXQsXG4gICAgICBpbnRlcnZhbE1zOiAyMDBcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHJlbWFpbmluZ0RldmljZXMubGVuZ3RoID4gMCkge1xuICAgICAgbG9nLndhcm4oYFRoZSBmb2xsb3dpbmcgZGV2aWNlcyBhcmUgc3RpbGwgbm90IGluIHRoZSBjb3JyZWN0IHN0YXRlIGFmdGVyICR7dGltZW91dH0gbXM6YCk7XG4gICAgICBmb3IgKGxldCBkZXZpY2Ugb2YgcmVtYWluaW5nRGV2aWNlcykge1xuICAgICAgICBsb2cud2FybihgICAgICR7ZGV2aWNlfWApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0U2ltdWxhdG9ySW5mbyAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBkZXZpY2VzU2V0UGF0aFxuICB9ID0gb3B0cztcbiAgLy8gc2VlIHRoZSBSRUFETUUgZm9yIGdpdGh1Yi5jb20vYXBwaXVtL25vZGUtc2ltY3RsIGZvciBleGFtcGxlIG91dHB1dCBvZiBnZXREZXZpY2VzKClcbiAgbGV0IGRldmljZXMgPSBhd2FpdCBuZXcgU2ltY3RsKHtcbiAgICBkZXZpY2VzU2V0UGF0aFxuICB9KS5nZXREZXZpY2VzKCk7XG5cbiAgZGV2aWNlcyA9IF8udG9QYWlycyhkZXZpY2VzKVxuICAgIC5tYXAoKHBhaXIpID0+IHBhaXJbMV0pXG4gICAgLnJlZHVjZSgoYSwgYikgPT4gYS5jb25jYXQoYiksIFtdKTtcbiAgcmV0dXJuIF8uZmluZChkZXZpY2VzLCAoc2ltKSA9PiBzaW0udWRpZCA9PT0gdWRpZCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNpbUV4aXN0cyAodWRpZCkge1xuICByZXR1cm4gISEoYXdhaXQgZ2V0U2ltdWxhdG9ySW5mbyh1ZGlkKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERldmVsb3BlclJvb3QgKCkge1xuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3hjb2RlLXNlbGVjdCcsIFsnLXAnXSk7XG4gIHJldHVybiBzdGRvdXQudHJpbSgpO1xufVxuXG4vKipcbiAqIEFjdGl2YXRlcyB0aGUgYXBwIGhhdmluZyB0aGUgZ2l2ZW4gcHJvY2VzcyBpZGVudGlmaWVyLlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL2FwcGtpdC9uc3J1bm5pbmdhcHBsaWNhdGlvbi8xNTI4NzI1LWFjdGl2YXRld2l0aG9wdGlvbnM/bGFuZ3VhZ2U9b2JqY1xuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHBpZCBBcHAgcHJvY2VzcyBpZGVudGlmaWVyXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGdpdmVuIFBJRCBpcyBub3QgcnVubmluZyBvciB0aGVyZSB3YXMgYSBmYWlsdXJlXG4gKiB3aGlsZSBhY3RpdmF0aW5nIHRoZSBhcHBcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWN0aXZhdGVBcHAgKHBpZCkge1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJ29zYXNjcmlwdCcsIFsnLWUnLCBBUFBfQUNUSVZBVElPTl9TQ1JJUFQocGlkKV0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTaW11bGF0b3Igd2luZG93IGNhbm5vdCBiZSBhY3RpdmF0ZWQuIE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufVxuXG5leHBvcnQge1xuICBraWxsQWxsU2ltdWxhdG9ycyxcbiAgc2ltRXhpc3RzLFxuICBnZXRTaW11bGF0b3JJbmZvLFxuICB0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudCxcbiAgZ2V0RGV2ZWxvcGVyUm9vdCxcbiAgYWN0aXZhdGVBcHAsXG4gIFNBRkFSSV9TVEFSVFVQX1RJTUVPVVRfTVMsXG4gIE1PQklMRV9TQUZBUklfQlVORExFX0lELFxuICBTSU1VTEFUT1JfQVBQX05BTUUsXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLGFBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLFNBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLFlBQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLFdBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLEtBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUdBLE1BQU1PLCtCQUErQixHQUFHLEtBQUs7QUFDN0MsTUFBTUMseUJBQXlCLEdBQUcsRUFBRSxHQUFHLElBQUk7QUFBQ0MsT0FBQSxDQUFBRCx5QkFBQSxHQUFBQSx5QkFBQTtBQUM1QyxNQUFNRSx1QkFBdUIsR0FBRyx3QkFBd0I7QUFBQ0QsT0FBQSxDQUFBQyx1QkFBQSxHQUFBQSx1QkFBQTtBQUN6RCxNQUFNQyxrQkFBa0IsR0FBRyxlQUFlO0FBQUNGLE9BQUEsQ0FBQUUsa0JBQUEsR0FBQUEsa0JBQUE7QUFDM0MsTUFBTUMscUJBQXFCLEdBQUlDLEdBQUcsSUFBTTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxR0EsR0FBSTtBQUN6RztBQUNBLCtDQUErQ0EsR0FBSTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtREEsR0FBSTtBQUN2RDtBQUNBO0FBQ0EsQ0FBQztBQUdELE1BQU1DLFVBQVUsR0FBRztFQUNqQkMsT0FBTyxFQUFFLGFBQWE7RUFDdEJDLE1BQU0sRUFBRTtBQUNWLENBQUM7QUFFRCxTQUFTQywwQkFBMEJBLENBQUVDLElBQUksRUFBRTtFQUN6QyxJQUFJLENBQUNKLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDLEVBQUU7SUFDckIsTUFBTSxJQUFJQyxLQUFLLENBQUUsSUFBR0QsSUFBSywyQ0FBMENFLElBQUksQ0FBQ0MsU0FBUyxDQUFDQyxlQUFDLENBQUNDLElBQUksQ0FBQ1QsVUFBVSxDQUFDLENBQUUsRUFBQyxDQUFDO0VBQzFHO0VBQ0EsT0FBT0EsVUFBVSxDQUFDSSxJQUFJLENBQUM7QUFDekI7QUFPQSxlQUFlTSxLQUFLQSxDQUFFQyxPQUFPLEVBQUVDLFNBQVMsR0FBRyxLQUFLLEVBQUU7RUFDaEQsSUFBSUMsSUFBSSxHQUFHRCxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO0VBQ2xDQyxJQUFJLENBQUNDLElBQUksQ0FBQyxJQUFJLEVBQUVILE9BQU8sQ0FBQztFQUN4QixJQUFJO0lBQ0YsTUFBTSxJQUFBSSxrQkFBSSxFQUFDLE9BQU8sRUFBRUYsSUFBSSxDQUFDO0lBQ3pCLE9BQU8sQ0FBQztFQUNWLENBQUMsQ0FBQyxPQUFPRyxHQUFHLEVBQUU7SUFDWixJQUFJLENBQUNSLGVBQUMsQ0FBQ1MsV0FBVyxDQUFDRCxHQUFHLENBQUNFLElBQUksQ0FBQyxFQUFFO01BQzVCLE1BQU0sSUFBSWIsS0FBSyxDQUFFLCtCQUE4Qk0sT0FBUSx1QkFBc0JLLEdBQUcsQ0FBQ0UsSUFBSyxFQUFDLENBQUM7SUFDMUY7SUFDQUMsZUFBRyxDQUFDQyxLQUFLLENBQUUsa0RBQWlEVCxPQUFRLEtBQUlLLEdBQUcsQ0FBQ0ssT0FBUSxFQUFDLENBQUM7SUFDdEYsTUFBTUwsR0FBRztFQUNYO0FBQ0Y7QUFFQSxlQUFlTSxpQkFBaUJBLENBQUVDLE9BQU8sR0FBRzlCLCtCQUErQixFQUFFO0VBQzNFMEIsZUFBRyxDQUFDSyxLQUFLLENBQUMsNEJBQTRCLENBQUM7RUFDdkMsTUFBTUMsWUFBWSxHQUFHLE1BQU0sSUFBQUMsdUJBQVUsRUFBQyxJQUFJLENBQUM7RUFDM0MsTUFBTWYsT0FBTyxHQUFHZ0IsYUFBSSxDQUFDQyxLQUFLLENBQUMvQixrQkFBa0IsQ0FBQyxDQUFDTyxJQUFJO0VBR25EbUIsT0FBTyxHQUFHQSxPQUFPLElBQUlFLFlBQVksQ0FBQ0ksS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0VBRXJELElBQUk7SUFDRixNQUFNLElBQUFkLGtCQUFJLEVBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRVUsWUFBWSxDQUFDSSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEtBQUssR0FBRyxRQUFRLENBQUMsRUFBRTtNQUFDTjtJQUFPLENBQUMsQ0FBQztFQUNuRyxDQUFDLENBQUMsT0FBT08sR0FBRyxFQUFFLENBQUM7RUFFZixNQUFNQyxJQUFJLEdBQUcsRUFBRTtFQUNmLElBQUk7SUFDRixNQUFNO01BQUNDO0lBQU0sQ0FBQyxHQUFHLE1BQU0sSUFBQWpCLGtCQUFJLEVBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFHLEdBQUVKLE9BQVEsc0JBQXFCLENBQUMsQ0FBQztJQUM5RSxJQUFJcUIsTUFBTSxDQUFDQyxJQUFJLENBQUMsQ0FBQyxFQUFFO01BQ2pCRixJQUFJLENBQUNqQixJQUFJLENBQUMsR0FBSWtCLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLEtBQUssQ0FBRSxDQUFDO0lBQzVDO0VBQ0YsQ0FBQyxDQUFDLE9BQU9DLENBQUMsRUFBRTtJQUNWLElBQUlBLENBQUMsQ0FBQ2pCLElBQUksS0FBSyxDQUFDLEVBQUU7TUFDaEJDLGVBQUcsQ0FBQ0ssS0FBSyxDQUFFLEdBQUViLE9BQVEsZ0NBQStCLENBQUM7TUFDckQ7SUFDRjtJQUNBLElBQUlILGVBQUMsQ0FBQzRCLE9BQU8sQ0FBQ0wsSUFBSSxDQUFDLEVBQUU7TUFDbkJaLGVBQUcsQ0FBQ2tCLElBQUksQ0FBRSxlQUFjRixDQUFDLENBQUNqQixJQUFLLDRCQUEyQlAsT0FBUSxxQ0FBb0MsQ0FBQztJQUN6RztFQUNGO0VBQ0EsSUFBSSxDQUFDSCxlQUFDLENBQUM0QixPQUFPLENBQUNMLElBQUksQ0FBQyxFQUFFO0lBQ3BCWixlQUFHLENBQUNLLEtBQUssQ0FBRSxzQkFBcUJPLElBQUksQ0FBQ08sSUFBSSxDQUFDLElBQUksQ0FBRSxFQUFDLENBQUM7SUFDbEQsSUFBSTtNQUNGLE1BQU0sSUFBQXZCLGtCQUFJLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUlnQixJQUFJLENBQUNRLEdBQUcsQ0FBRXhDLEdBQUcsSUFBTSxHQUFFQSxHQUFJLEVBQUMsQ0FBRSxDQUFDLENBQUM7SUFDOUQsQ0FBQyxDQUFDLE9BQU8rQixHQUFHLEVBQUUsQ0FBQztFQUNqQjtFQUVBWCxlQUFHLENBQUNLLEtBQUssQ0FBRSxvQ0FBbUNiLE9BQVEsRUFBQyxDQUFDO0VBQ3hELElBQUk7SUFDRixNQUFNRCxLQUFLLENBQUNDLE9BQU8sRUFBRSxJQUFJLENBQUM7RUFDNUIsQ0FBQyxDQUFDLE9BQU9tQixHQUFHLEVBQUUsQ0FBQztFQUlmLElBQUlVLGdCQUFnQixHQUFHLEVBQUU7RUFDekIsZUFBZUMsY0FBY0EsQ0FBQSxFQUFJO0lBQy9CRCxnQkFBZ0IsR0FBRyxFQUFFO0lBQ3JCLElBQUlFLE9BQU8sR0FBRyxNQUFNLElBQUlDLG1CQUFNLENBQUMsQ0FBQyxDQUFDQyxVQUFVLENBQUMsQ0FBQztJQUM3Q0YsT0FBTyxHQUFHbEMsZUFBQyxDQUFDcUMsT0FBTyxDQUFDckMsZUFBQyxDQUFDc0MsTUFBTSxDQUFDSixPQUFPLENBQUMsQ0FBQztJQUN0QyxPQUFPbEMsZUFBQyxDQUFDdUMsS0FBSyxDQUFDTCxPQUFPLEVBQUdNLEdBQUcsSUFBSztNQUMvQixNQUFNQyxLQUFLLEdBQUdELEdBQUcsQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUNyQyxNQUFNQyxJQUFJLEdBQUcsQ0FBQyxVQUFVLEVBQUUsYUFBYSxFQUFFLGNBQWMsQ0FBQyxDQUFDQyxRQUFRLENBQUNILEtBQUssQ0FBQztNQUN4RSxJQUFJLENBQUNFLElBQUksRUFBRTtRQUNUWCxnQkFBZ0IsQ0FBQzFCLElBQUksQ0FBRSxHQUFFa0MsR0FBRyxDQUFDNUMsSUFBSyxLQUFJNEMsR0FBRyxDQUFDSyxHQUFJLFdBQVVMLEdBQUcsQ0FBQ00sSUFBSyx3QkFBdUJMLEtBQU0sR0FBRSxDQUFDO01BQ25HO01BQ0EsT0FBT0UsSUFBSTtJQUNiLENBQUMsQ0FBQztFQUNKO0VBQ0EsSUFBSTtJQUNGLE1BQU0sSUFBQUksMEJBQWdCLEVBQUNkLGNBQWMsRUFBRTtNQUNyQ2UsTUFBTSxFQUFFakMsT0FBTztNQUNma0MsVUFBVSxFQUFFO0lBQ2QsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU96QyxHQUFHLEVBQUU7SUFDWixJQUFJd0IsZ0JBQWdCLENBQUNrQixNQUFNLEdBQUcsQ0FBQyxFQUFFO01BQy9CdkMsZUFBRyxDQUFDa0IsSUFBSSxDQUFFLGtFQUFpRWQsT0FBUSxNQUFLLENBQUM7TUFDekYsS0FBSyxJQUFJb0MsTUFBTSxJQUFJbkIsZ0JBQWdCLEVBQUU7UUFDbkNyQixlQUFHLENBQUNrQixJQUFJLENBQUUsT0FBTXNCLE1BQU8sRUFBQyxDQUFDO01BQzNCO0lBQ0Y7SUFDQSxNQUFNM0MsR0FBRztFQUNYO0FBQ0Y7QUFFQSxlQUFlNEMsZ0JBQWdCQSxDQUFFTixJQUFJLEVBQUVPLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtFQUNoRCxNQUFNO0lBQ0pDO0VBQ0YsQ0FBQyxHQUFHRCxJQUFJO0VBRVIsSUFBSW5CLE9BQU8sR0FBRyxNQUFNLElBQUlDLG1CQUFNLENBQUM7SUFDN0JtQjtFQUNGLENBQUMsQ0FBQyxDQUFDbEIsVUFBVSxDQUFDLENBQUM7RUFFZkYsT0FBTyxHQUFHbEMsZUFBQyxDQUFDdUQsT0FBTyxDQUFDckIsT0FBTyxDQUFDLENBQ3pCSCxHQUFHLENBQUV5QixJQUFJLElBQUtBLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUN0QkMsTUFBTSxDQUFDLENBQUNDLENBQUMsRUFBRUMsQ0FBQyxLQUFLRCxDQUFDLENBQUNFLE1BQU0sQ0FBQ0QsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO0VBQ3BDLE9BQU8zRCxlQUFDLENBQUM2RCxJQUFJLENBQUMzQixPQUFPLEVBQUdNLEdBQUcsSUFBS0EsR0FBRyxDQUFDTSxJQUFJLEtBQUtBLElBQUksQ0FBQztBQUNwRDtBQUVBLGVBQWVnQixTQUFTQSxDQUFFaEIsSUFBSSxFQUFFO0VBQzlCLE9BQU8sQ0FBQyxFQUFFLE1BQU1NLGdCQUFnQixDQUFDTixJQUFJLENBQUMsQ0FBQztBQUN6QztBQUVBLGVBQWVpQixnQkFBZ0JBLENBQUEsRUFBSTtFQUNqQyxNQUFNO0lBQUN2QztFQUFNLENBQUMsR0FBRyxNQUFNLElBQUFqQixrQkFBSSxFQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0VBQ25ELE9BQU9pQixNQUFNLENBQUNDLElBQUksQ0FBQyxDQUFDO0FBQ3RCO0FBV0EsZUFBZXVDLFdBQVdBLENBQUV6RSxHQUFHLEVBQUU7RUFDL0IsSUFBSTtJQUNGLE1BQU0sSUFBQWdCLGtCQUFJLEVBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxFQUFFakIscUJBQXFCLENBQUNDLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDN0QsQ0FBQyxDQUFDLE9BQU9vQyxDQUFDLEVBQUU7SUFDVixNQUFNLElBQUk5QixLQUFLLENBQUUseURBQXdEOEIsQ0FBQyxDQUFDc0MsTUFBTSxJQUFJdEMsQ0FBQyxDQUFDZCxPQUFRLEVBQUMsQ0FBQztFQUNuRztBQUNGIn0=